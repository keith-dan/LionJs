var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(u,v,n){u!=Array.prototype&&u!=Object.prototype&&(u[v]=n.value)};$jscomp.getGlobal=function(u){return"undefined"!=typeof window&&window===u?u:"undefined"!=typeof global&&null!=global?global:u};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(u,v,n,p){if(v){n=$jscomp.global;u=u.split(".");for(p=0;p<u.length-1;p++){var y=u[p];y in n||(n[y]={});n=n[y]}u=u[u.length-1];p=n[u];v=v(p);v!=p&&null!=v&&$jscomp.defineProperty(n,u,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Array.prototype.fill",function(u){return u?u:function(u,n,p){var v=this.length||0;0>n&&(n=Math.max(0,v+n));if(null==p||p>v)p=v;p=Number(p);0>p&&(p=Math.max(0,v+p));for(n=Number(n||0);n<p;n++)this[n]=u;return this}},"es6","es3");
!function(u){function v(c,d,a){var b=c[d];c[d]=function(){if(a.length===arguments.length)return a.apply(this,arguments);if("function"===typeof b)return b.apply(this,arguments)}}function n(c){for(var d=c[0].x,a=0,b=c[0].y,f=0,k=0;k<c.length;k++)d=d<c[k].x?d:c[k].x,a=a>c[k].x+c[k].width?a:c[k].x+c[k].width,b=b<c[k].y?b:c[k].y,f=f>c[k].y+c[k].height?f:c[k].y+c[k].height;c=new A;c.x=d;c.y=b;c.width=a-d;c.height=f-b;return c}function p(c){for(var d=[],a=0;a<c.length;a++)c[a]instanceof l.LinkElement||d.push(c[a].getOutRect());
return n(d)}function y(c,d,a,b,f,k){b<2*k&&(k=b/2);f<2*k&&(k=f/2);c.beginPath();c.moveTo(d+k,a);c.arcTo(d+b,a,d+b,a+f,k);c.arcTo(d+b,a+f,d,a+f,k);c.arcTo(d,a+f,d,a,k);c.arcTo(d,a,d+b,a,k);c.closePath()}function E(c,d){for(var a=0;a<d.length;a++)c.push(d[a])}function F(c){return(new Date).getTime().toString()+parseInt(1E5*Math.random())}function L(c,d){if(c.y>d.y&&c.x>d.x)return 0;if(c.y>d.y&&c.x<d.x)return 1;if(c.y<d.y&&c.x<d.x)return 2;if(c.y<d.y&&c.x>d.x)return 3}function M(c,d){if(d instanceof
l.Gradient){if(d.type==l.Gradient.Type.Linear){c=c.createLinearGradient(d.drawPoint1.x,d.drawPoint1.y,d.drawPoint2.x,d.drawPoint2.y);for(var a=0;a<d.colors.length;a++)c.addColorStop(d.colors[a].step,d.colors[a].color);return c}if(d.type==l.Gradient.Type.Radial){a=l.Util.getDistance(d.drawPoint1,d.drawPoint2);c=c.createRadialGradient(d.drawPoint1.x,d.drawPoint1.y,0,d.drawPoint1.x,d.drawPoint1.y,a);for(a=0;a<d.colors.length;a++)c.addColorStop(d.colors[a].step,d.colors[a].color);return c}}else return d}
function N(c){this.eleDebug=new l.TextElement;this.eleDebug.x=0;this.eleDebug.y=0;this.eleDebug.canDrag=!1;this.eleDebug.autoSize=!0;c.currentScene.addElement(this.eleDebug,l.LayerMode.Force);this.write=function(c){l.Util.andEnum(l.debug,l.DebugMode.Info)&&(console.log(c),this.eleDebug.foreColor="black",this.eleDebug.text=c)};this.warn=function(c){l.Util.andEnum(l.debug,l.DebugMode.Warn)&&(console.warn(c),this.eleDebug.foreColor="orange",this.eleDebug.text=c)};this.err=function(c){l.Util.andEnum(l.debug,
l.DebugMode.Error)&&(console.error(c),this.eleDebug.foreColor="red",this.eleDebug.text=c)}}function A(c,d,a,b){0==arguments.length&&(this.height=this.width=this.y=this.x=0);this.x=c;this.y=d;this.width=a;this.height=b}function C(c,d){this.x=c;this.y=d}var x={},l=u.lion||(u.lion={Version:"1.0.6",Position:{Free:0,TopLeft:4,TopRight:5,BottomLeft:7,BottomRight:8},ArrowDirection:{Left:1,Right:2,Both:3,None:0},TextStyle:{None:0,UnderLine:1,DeleteLine:2},ArrowStyle:{Triangle:1,Arrow:2,Circle:3,Rect:4,None:0},
LineStyle:{Solid:0,Dotted:1},Direction:{Top:-1,Right:-2,Bottom:1,Left:2},LayerMode:{Action:0,Force:1,Background:2,Virtual:3},SceneMode:{SingleSelect:1,MultipleSelect:2,Drag:4,Edit:8,Move:16,NonAction:32,NonAnimation:64,Normal:15,Preview:96},Status:{None:1,Selected:2,Draging:4,Editing:8,Hover:16,NodeHover:32},Keys:{Shift:16},EditMode:{Select:0,Scale:1,Rotate:2,Free:3,NodeControl:4,None:5},EndPointMode:{Start:0,End:1,Middle:2,Center:3,TopLeft:11,TopRight:12,BottomLeft:13,BottomRight:14,MiddleLeft:15,
MiddleRight:16,MiddleTop:17,MiddleBottom:18,Landscape:21,Vertical:22,Free:31},Align:{Center:0,MiddleLeft:1,MiddleRight:2,TopMiddle:3,TopLeft:4,TopRight:5,BottomMiddle:6,BottomLeft:7,BottomRight:8,Start:10,End:11},DebugMode:{None:1,Info:2,Warn:4,Error:8,All:14}});l.debug=l.DebugMode.None;l.fromJson=function(c,d,a){console.log(typeof c);"string"==typeof c&&(c=c.replace(/\n/g,"\\n"),c=window.eval(c));d=l.Element.deserialize(c[0].stage,d);d.enddeserialize();return d};l.disposeAllStage=function(){for(var c=
0;c<l.Timer.stages.length;c++)l.Timer.stages[c].dispose(),l.Timer.stages[c]=null;l.Timer.stages=[]};l.Util=new function(){this.andEnum=function(c,d){return(c&d)==d};this.xorEnum=function(c,d){return this.andEnum(c,d)?c^d:c};this.orEnum=function(c,d){return this.andEnum(c,d)?c:c|d};this.isNullOrWhitespace=function(c){return!(null!=c&&""!=c)};this.is=function(c,d){return"string"==typeof d?"object"==typeof c&&c.tagName?c.tagName.toLowerCase()==d.toLowerCase():typeof c==d:c instanceof d};this.toRadian=
function(c){return c*Math.PI/180};this.toAngle=function(c){return 180*c/Math.PI};this.getDistance=function(c,d){var a=Math.abs(d.x-c.x);c=Math.abs(d.y-c.y);return Math.sqrt(a*a+c*c)};this.inRect=function(c,d,a,b,f,k,e,q){if(8==arguments.length)return c=0>a?a+c:c,d=0>b?b+d:d,a=Math.abs(a),b=Math.abs(b),f>=c&&f+e<=a+c&&k>=d&&k+q<=d+b;if(6==arguments.length)return f>=c&&f<=a+c&&k>=d&&k<=d+b};this.isNumber=function(c){return/^[-0-9]+.?[0-9]*$/.test(c)}};l.Timer={runing:0,fps:33,canRun:!0,stages:[],init:function(){if(!l.Timer.runing){var c=
function(){if(l.Timer.canRun){var a=Date.now(),b=a-d;if(b>l.Timer.fps)for(d=a-b%l.Timer.fps,a=0;a<l.Timer.stages.length;a++)l.Timer.stages[a].canRender&&l.Timer.stages[a].isinited&&l.Timer.stages[a].render();window.requestAnimationFrame(c)}},d=Date.now();c();l.Timer.runing=1}}};Object.defineProperties(A.prototype,{x:{get:function(){return this.__x__},set:function(c){l.Util.isNumber(c)?this.__x__=c:0},enumerable:!1},y:{get:function(){return this.__y__},set:function(c){l.Util.isNumber(c)?this.__y__=
c:0},enumerable:!1},width:{get:function(){return this.__width__},set:function(c){l.Util.isNumber(c)?this.__width__=c:0},enumerable:!1},height:{get:function(){return this.__height__},set:function(c){l.Util.isNumber(c)?this.__height__=c:0},enumerable:!1},empty:{get:function(){return null==this.x||null==this.y||null==this.width||null==this.height||NaN==this.x||NaN==this.y||NaN==this.width||NaN==this.height||0==this.x&&0==this.y&&0==this.width&&0==this.height?!0:!1},enumerable:!1},bounds:{get:function(){return{leftTop:new C(this.x,
this.y),rightTop:new C(this.x+this.width,this.y),leftBottom:new C(this.x,this.y+this.height),rightBottom:new C(this.x+this.width,this.y+this.height)}},enumerable:!0},center:{get:function(){return new C(this.x+this.width/2,this.y+this.height/2)},enumerable:!0}});A.prototype.intersect=function(c){return this.x+this.width>c.x&&this.x<c.x+c.width&&this.y+this.height>c.y&&this.y<c.y+c.height?this.x<c.x&&this.width>c.width&&this.y<c.y&&this.height>c.height?1:0:-1};A.prototype.calc=function(){this.bounds.leftTop.x=
this.x;this.bounds.leftTop.y=this.y;this.bounds.rightTop.x=this.x+this.width;this.bounds.rightTop.y=this.y;this.bounds.leftBottom.x=this.x;this.bounds.leftBottom.y=this.y+this.height;this.bounds.rightBottom.x=this.x+this.width;this.bounds.rightBottom.y=this.y+this.height;this.center.x=this.x+this.width/2;this.center.y=this.y+this.height/2};l.Rect=A;!function(c){function d(){this.enable=!0;this.interval=33;this.element=null;this.endreverse=this.finished=!1;this.loop=!0;var a=this,b=!0;Object.defineProperties(this,
{invalid:{get:function(){return b},set:function(c){(b=c)&&a.element.invalidLayout()},enumerable:!1}});var c=new Date;this.doAnimation=function(){if(this.enable){var b=new Date;b-c>=a.interval&&(this.doAnimationCore()&&!a.loop&&(this.finished=!0),c=b)}};this.doAnimationCore=function(){};this.preAnimation=function(){}}function a(a){d.call(this);this.steps=[];var c=this;this.doAnimationCore=function(){for(var a=0;a<c.steps.length;a++)if(1==c.steps[a].direct)if(c.element[c.steps[a].field]>=c.steps[a].to){if(!this.loop)return!0;
c.steps[a].endreverse&&c.steps[a].reverse();c.element[c.steps[a].field]=c.steps[a].from}else c.element[c.steps[a].field]+=c.steps[a].by;else if(c.element[c.steps[a].field]<=c.steps[a].to){if(!this.loop)return!0;c.steps[a].endreverse&&c.steps[a].reverse();c.element[c.steps[a].field]=c.steps[a].from}else c.element[c.steps[a].field]-=c.steps[a].by;return!1};if(a){a.interval&&(this.interval=a.interval);for(var f=0;f<a.steps.length;f++)a.steps[f]instanceof b?this.steps.push(a.steps[f]):a.steps[f]instanceof
Object&&this.steps.push(new b(a.steps[f].field,a.steps[f].from,a.steps[f].to,a.steps[f].by,a.steps[f].endreverse))}}function b(a,b,c,f,d){this.field=a;this.from=b;this.to=c;this.by=f?f:c;this.endreverse=d?d:!1;this.direct=1;this.reverse=function(){this.direct=0-this.direct;var a=this.from;this.from=this.to;this.to=a;f||(this.by=this.to)}}function f(a){d.call(this);var b=this,c=0;this.frameList=[];this.addFrame=function(a){if(l.Util.is(a,"string")){var c=new Image;c.src=a;b.frameList.push(c)}else l.Util.is(a,
Image)&&b.frameList.push(a)};this.doAnimationCore=function(){b.element.backgroundImage=b.frameList[c];if(c<b.frameList.length-1)c++;else{if(!this.loop)return!0;c=0}return!1};if(a){a.interval&&(b.interval=a.interval);if(a.frameList)for(var f=0;f<a.frameList.length;f++)b.addFrame(a.frameList[f]);void 0!=a.enable&&(b.enable=a.enable)}}function k(a){d.call(this);this.stepLength=10;this.path=[];this.speed=3;var b=this,c=0,f=[];this.addPath=function(a){b.path.push(a);var c=b.speed;if(a.x1==a.x2){var e=
Math.abs(Math.abs(a.y2)-Math.abs(a.y1))/c;for(var d=0;d<e;d++){var k=a.y2>a.y1?a.y1+d*c:a.y1-d*c;f.push({x:a.x1,y:k})}}else if(a.y1==a.y2)for(e=Math.abs(Math.abs(a.x2)-Math.abs(a.x1))/c,d=0;d<e;d++){var g=a.x2>a.x1?a.x1+d*c:a.x1-d*c;f.push({x:g,y:a.y1})}else{var h=(a.y1-a.y2)/(a.x1-a.x2);e=Math.abs(Math.abs(a.x2)-Math.abs(a.x1))/c;for(d=0;d<e;d++)k=0<h?a.y1>a.y2>0?a.y1-h*d*c:h*d*c+a.y1:a.y1<a.y2>0?a.y1-h*d*c:h*d*c+a.y1,g=a.x1>a.x2>0?a.x1-d*c:a.x1+d*c,f.push({x:g,y:k})}};this.doAnimationCore=function(){if(0<
f.length)if(b.element.x=f[c].x-b.element.drawBounds.width/2,b.element.y=f[c].y-b.element.drawBounds.height/2,c<f.length-1)c++;else{if(!this.loop)return!0;c=0}return!1};this.preAnimation=function(){if(b.invalid){if(e&&0<e.points.length){c=0;b.path=[];f=[];for(var a=1;a<e.points.length;a++)b.addPath({x1:e.points[a-1].x/e.scale,y1:e.points[a-1].y/e.scale,x2:e.points[a].x/e.scale,y2:e.points[a].y/e.scale})}b.invalid=!1}};if(a)if(a instanceof l.LineElement){var e=a;e.bindPathAnimations.push(b)}else if(a instanceof
Object){if(a.interval&&(b.interval=a.interval),a.path)for(var k=0;k<a.path.length;k++)b.addPath(a.path[k])}else throw"datatype must be json or LineElement";}c.Animations={};d.prototype.setElement=function(a){this.element=a};c.Animation=d;a.prototype=new d;c.Animations.StepAnimation=a;f.prototype=new d;c.Animations.FrameAnimation=f;f.prototype.setElement=function(a){d.prototype.setElement.call(this,a);this.doAnimationCore()};k.prototype=new d;c.Animations.PathAnimation=k}(l);!function(c){function d(a,
b,c,d,e,q,m){this.type=a;this.x1=b;this.y1=c;this.x2=d;this.y2=e;this.colors=[];q&&m&&(this.addColorStop(0,q),this.addColorStop(1,m))}c.Gradient=d;d.Type={Linear:1,Radial:2};Object.defineProperties(d.prototype,{drawPoint1:{get:function(){return new C(this.owner.drawBounds.x+this.x1*this.owner.scale,this.owner.drawBounds.y+this.y1*this.owner.scale)},enumerable:!0},drawPoint2:{get:function(){return new C(this.owner.drawBounds.x+this.x2*this.owner.scale,this.owner.drawBounds.y+this.y2*this.owner.scale)},
enumerable:!0}});d.prototype.addColorStop=function(a,b){this.colors.push({step:a,color:b})};d.prototype.setOwner=function(a){this.owner=a}}(l);!function(c){function d(){this.list=[];this.callback}d.prototype.load=function(a){function b(){c++;c==il.list.length&&il.callback&&il.callback(il.list)}for(var c=0,d=0;d<a.length;d++){if(a[d]instanceof Image)this.list.push(a[d]);else if(l.Util.is(a[d],"string")){var e=new Image;e.onload=b;e.src=a[d];this.list.push(e)}this.list[d].onloadedmetadata=b}};d.prototype.onLoaded=
function(a){this.callback=a};d.prototype.getImage=function(a){return this.list[a]};c.ImageList=d}(l);!function(c){function d(a,b,f){c.ImageList.call(this);this.blockWidth=a;this.blockHeight=b;this.matrixCut=void 0==f?!0:f}d.prototype=new c.ImageList;d.prototype.load=function(a){function b(a,b,c){b=a.getImageData(0,0,b,c);c=0;for(var f=b.data.length;c<f;c+=4)b.data[c+3]*=0;a.putImageData(b,0,0)}var c=this,d=this.blockWidth,e=this.blockHeight,q=new Image;q.onload=function(){var a=parseInt(q.width/d),
f=parseInt(q.height/e),k=document.createElement("canvas");k.setAttribute("width",d+"px");k.setAttribute("height",e+"px");var H=k.getContext("2d");H.save();if(c.matrixCut)for(var l=0;l<f;l++){c.list[l]=[];for(var B=0;B<a;B++){b(H,d,e);H.drawImage(q,B*d,l*e,d,e,0,0,d,e);var z=k.toDataURL();c.list[l][B]=z}}else{var I=0;for(l=0;l<f;l++)for(B=0;B<a;B++)b(H,d,e),H.drawImage(q,B*d,l*e,d,e,0,0,d,e),z=k.toDataURL(),c.list[I]=z,I++}c.callback&&c.callback(c.list)};q.src=a};c.ImageMatrix=d}(l);!function(c){function d(){this.type=
"lion.Element";var a=this.__data__={};a.id=-1;a.parent=null;a.stage=null;a.events={};a.invalid=!0;a.isdisposed=!1}d.prototype.setValue=function(a,b){this.__data__[a]=b};d.prototype.getValue=function(a){return this.__data__[a]};Object.defineProperties(d.prototype,{id:{get:function(){return this.getValue("id")},enumerable:!0},invalid:{get:function(){return this.getValue("invalid")},enumerable:!1},parent:{get:function(){return this.getValue("parent")},set:function(a){this.setValue("parent",a)},enumerable:!1},
stage:{get:function(){return this.getValue("stage")},set:function(a){this.setValue("stage",a)},enumerable:!1},events:{get:function(){return this.getValue("events")},enumerable:!1},isdisposed:{get:function(){return this.getValue("isdisposed")},set:function(a){this.setValue("isdisposed",a)},enumerable:!1}});d.prototype.invalidLayout=function(a){this.setValue("invalid",!0)};d.prototype.clone=function(){var a=new (eval(this.type)),b;for(b in this)"id"!=b&&(c.Util.is(this[b],"function")||c.Util.is(this[b],
"object")||(a[b]=this[b]));a instanceof c.LineElement?a.setPoint(this.startNode.x+10,this.startNode.y+10,this.endNode.x+10,this.endNode.y+10):(a.x+=10,a.y+=10);return a};d.prototype.setParent=function(a){this.parent=a};d.prototype.serialize=function(a){a=a?a:this;var b="{",f;for(f in a)if(0!=f.indexOf("$"))if(null==a[f]&&void 0==a[f])b+='"'+f+'":null,';else if(c.Util.is(a[f],"number"))b+='"'+f+'":'+a[f]+",";else if(c.Util.is(a[f],"string"))b+='"'+f+'":"'+a[f]+'",';else if(c.Util.is(a[f],"object")){var d=
a.onserialize(f,a[f]);d&&(b+=d+",")}else c.Util.is(a[f],"boolean")?b+='"'+f+'":'+(a[f]?"true":"false")+",":c.Util.is(a[f],"function");","==b[b.length-1]&&(b=b.substr(0,b.length-1));return b+"}"};d.prototype.getOutRect=function(){if(this.drawBounds.empty)return new A(this.x,this.y,this.width,this.height);var a=this.drawBounds,b=new A(a.x,a.y,a.width,a.height);if(this.isTextElement){var c=this.getTextRect();c&&(b=n([a,c]))}0<this.borderSize&&(b.x-=this.borderSize,b.y-=this.borderSize,b.width+=2*this.borderSize,
b.height+=2*this.borderSize);return b};d.prototype.equals=function(a){return null!=a?this.id==a.id:!1};d.prototype.onserialize=function(a,b){return null};d.prototype.ondeserialize=function(a,b){return!1};d.prototype.enddeserialize=function(){};d.prototype.dispose=function(){this.isdisposed||(this.isdisposed=!0)};d.deserialize=function(a,b){var c=eval(a.type);b="lion.Stage"==a.type?new c(b,!0):new c(b);for(var d in a)"type"!=d&&("id"==d?b.setValue(d,a[d]):b.ondeserialize(d,a[d])||(b[d]=a[d]));return b};
c.Element=d}(l);!function(c){function d(a){c.Element.call(this);this.type="lion.Stage";this.scenes=[];this.backgroundColor=this.currentScene=null;var b=this,f=null;f=c.Util.is(a,"string")?document.getElementById(a):a;var d=null,e=null,q=!0,m=null;Object.defineProperties(this,{autoSize:{get:function(){return d},set:function(a){d=a},enumerable:!1},debugger:{get:function(){return m},enumerable:!1},isinited:{get:function(){return e},set:function(a){e=a},enumerable:!1},canRender:{get:function(){return q},
set:function(a){q=a},enumerable:!1},cursor:{get:function(){return f.style.cursor},set:function(a){f.style.cursor=a},enumerable:!1}});this.createImage=function(a,c,f){if(c&&f){var d=b.canvas.toDataURL(),e=$("<canvas width='"+c+"px' height='"+f+"px' ></canvas>"),k=e[0].getContext("2d"),g=new Image(c,f);g.src=d;g.set;var h=null;g.onload=function(){k.drawImage(g,0,0,c,f);h=e[0].toDataURL();a(h)}}else a(b.canvas.toDataURL())};this.stopRender=function(){this.canRender=!1};this.startRender=function(){this.canRender=
!0};this.addScene=function(a){-1==a.id&&a.setValue("id",F());b.scenes.push(a);a.setParent(b);a.width<b.width&&(a.width=b.width);a.height<b.height&&(a.height=b.height)};this.changeScene=function(a){b.currentScene=this.scenes[a]};this.renderBackground=function(a){b.backgroundColor&&(a.fillStyle=b.backgroundColor,a.fillRect(0,0,b.width,b.height))};this.render=function(){var a=b.canvas.getContext("2d");a.msImageSmoothingEnabled=!0;if(b.currentScene){for(var f in x)x[f]instanceof c.Animation&&(x[f].doAnimation(),
x[f].finished&&delete x[f]);b.renderBackground(a);b.currentScene.preRender(a);b.currentScene.renderBackground(a);b.currentScene.render(a)}};this.resize=function(a,c){a=null!=a?a:f.clientWidth;c=null!=c?c:f.clientHeight;b.width=a;b.height=c;this.canvas.setAttribute("width",a+"px");this.canvas.setAttribute("height",c+"px");for(c=0;c<b.scenes.length;c++)b.scenes[c].invalidLayout("bounds")};this.fill=function(){b.currentScene.setScale(b.width/b.currentScene.width)};this.fillCenter=function(){function a(){window.requestAnimationFrame(function(){var c=
p(b.currentScene.layers.action.elements);if(c.width&&c.height){var f=b.width/c.width,d=b.height/c.height;b.currentScene.x-=c.x;b.currentScene.y-=c.y;b.currentScene.setScale(f<d?f:d)}else a()})}a()};this.new=function(a,b){return this.create(a,b)};this.create=function(a,b){var f=a;c.Util.is(a,"string")&&(f=eval(a));obj=new f(b);3==arguments.length?obj.setValue("id",arguments[2]):obj.setValue("id",F());return obj};this.dispose=function(){if(this.isdisposed)console.log("object was disposed");else{var a;
for(a=0;a<c.Timer.stages.length&&(!c.Timer.stages[a]||!this.equals(c.Timer.stages[a]));a++);if(-1<a){this.canvas.remove();for(var b=0;b<this.scenes.length;b++)this.scenes[b].dispose(),this.scenes[b]=null,this.scenes=[];x={};c.Timer.stages.splice(a,1)}this.isdisposed=!0}};!function(a){b.autoSize=!1;var d=f.clientWidth,e=f.clientHeight,k=document.createElement("canvas");k.setAttribute("width",d+"px");k.setAttribute("height",e+"px");f.style.overflow="hidden";f.appendChild(k);b.canvas=k;b.width=d;b.height=
e;b.drawBounds=new A(0,0,d,e);b.canvas.onmousedown=function(a){b.currentScene&&b.currentScene.__onmousedown(a)};b.canvas.onmousemove=function(a){0==a.button&&b.currentScene&&b.currentScene.__onmousemove(a)};b.canvas.onmouseup=function(a){b.currentScene&&b.currentScene.__onmouseup(a)};b.canvas.ondblclick=function(a){b.currentScene&&b.currentScene.__ondblclick(a)};window.addEventListener("keydown",function(a){b.currentScene&&b.currentScene.__onkeypress(a)});a[1]?b.isinited=!1:(b.setValue("id",F()),
a=b.create(c.Scene),b.addScene(a),b.changeScene(0),b.isinited=!0);m=new N(b);b.debugger.write("Stage Inited")}(arguments);this.notifyCmd=function(a,b){if("updateGraphicText"==a)null==h[b.id]?(a=document.createElement("span"),a.id=b.id,a.style.fontFamily=b.font,a.style.display="none",a.innerHTML=b.text,f.appendChild(a),h[b.id]=a):h[b.id].innerHTML=b.text;else{if("getGraphicText"==a)return null!=h[b.id]?h[b.id].textContent:null;"removeGraphicText"==a&&null!=h[b.id]&&(h[b.id].remove(),delete h[b.id])}};
var h={};this.enableContextMenu=function(a){a||(f.oncontextmenu=function(){self.event.returnValue=!1})};c.Timer.stages.push(b)}d.prototype=new c.Element;d.prototype.serialize=function(){var a='[{"engine":"lion","copyright":"keith dan",'+('"version":"'+c.Version+'",');a=a+'"stage":'+c.Element.prototype.serialize.call(this,this);return a+"}]"};d.prototype.setParent=function(a){};d.prototype.onserialize=function(a,b){var c="";if("scenes"==a){c+='"'+a+'":[';for(a=0;a<b.length;a++)c+=b[a].serialize()+
",";","==c[c.length-1]&&(c=c.substr(0,c.length-1));c+="]"}return c};d.prototype.ondeserialize=function(a,b){if("scenes"==a){for(a=0;a<b.length;a++)this.addScene(Element.deserialize(b[a]));return!0}return!this.autoSize||"width"!=a&&"height"!=a?!1:!0};d.prototype.enddeserialize=function(){for(var a=0;a<this.scenes.length;a++)this.scenes[a].enddeserialize();this.changeScene(0);this.isinited=!0};c.Stage=d}(l);!function(c){function d(a){function b(a,b){for(var c=-1,f=0;f<a.length;f++)if(a[f].equals(b)){c=
parseInt(f);break}-1<c&&a.splice(c,1)}function f(a,b,f){for(f=a.length-1;0<=f;f--){var d=a[f];if(d.canEvent&&d instanceof c.NodeElement&&0<d.displayNodes.length){var e=d.testNode(b.offsetX,b.offsetY);if(e)for(var k=0;k<d.displayNodes.length;k++)if(d.displayNodes[k].equals(e))return t&&(t.status=c.Util.xorEnum(d.status,c.Status.NodeHover)),d.status=c.Util.orEnum(d.status,c.Status.NodeHover),t=d,!0}if(d.testPoint(b.offsetX,b.offsetY))if(d instanceof c.Group&&0==r.length)d.status=c.Util.orEnum(d.status,
c.Status.Hover);else return t&&(t.group&&(t.group.status=c.Util.xorEnum(t.group.status,c.Status.Hover)),t.status=c.Util.xorEnum(t.status,c.Status.Hover),t.status=c.Util.xorEnum(t.status,c.Status.NodeHover)),t=d,d.status=c.Util.orEnum(d.status,c.Status.Hover),t.group&&(t.group.status=c.Util.orEnum(t.group.status,c.Status.Hover)),!0}return!1}function d(a,b){for(var d=0;d<a.length;d++){var f=a[d];if(f.invalid){f.nodes&&f.buildNodes();f.updateBounds(b);f instanceof c.BaseTextElement&&(f instanceof c.TextElement&&
f.autoSize||f.measureText(b));f.tooltip&&f.tooltip.measureText(b);for(var e=0;e<f.animations.length;e++)f.animations[e].invalid&&(f.animations[e].preAnimation(),f.animations[e].invalid=!1);f.setValue("invalid",!1)}}}function m(a){return a.visible&&(a instanceof c.LinkElement||-1!=g.stage.drawBounds.intersect(a.drawBounds))?!0:!1}function h(a,b){b.save();a.preRender(b);a.renderBackground(b);a.render(b);a instanceof c.BaseTextElement&&a.renderText(b,a.text,a.textRect,a.forceColor);c.Util.andEnum(a.status,
c.Status.Hover)&&a.renderHighLight(b);c.Util.andEnum(a.status,c.Status.Selected)&&a.renderHighLight(b);a instanceof c.NodeElement&&(a.editMode>c.EditMode.Select||0<a.displayNodes.length)&&(a.renderNodes(b),a.renderHoverNode(b));b.restore()}c.Element.call(this);this.type="lion.Layer";this.elements=[];this.mode=a;var g=this,l=1,J=!1,B=!1,z=new C(0,0),I=null,O,D=new C(10,10),u;Object.defineProperties(this,{scene:{get:function(){return I},set:function(a){I=a},enumerable:!1},width:{get:function(){return g.mode==
c.LayerMode.Force?g.scene.stage.width:g.scene.width},enumerable:!1},height:{get:function(){return g.mode==c.LayerMode.Force?g.scene.stage.height:g.scene.height},enumerable:!1},x:{get:function(){return g.mode==c.LayerMode.Force||g.mode==c.LayerMode.Virtual?0:g.scene.x},enumerable:!1},y:{get:function(){return g.mode==c.LayerMode.Force||g.mode==c.LayerMode.Virtual?0:g.scene.y},enumerable:!1},drawBounds:{get:function(){return O=new A(g.x,g.y,g.scene.stage.width,g.scene.stage.height)},enumerable:!1}});
this.toFront=function(a){for(var b=0;b<p.length&&!a.equals(p[b]);b++);p.splice(b,1);p.push(a);a instanceof c.Group&&this.__toFrontGroup(a)};this.__toFrontGroup=function(a){for(var b=0;b<a.elements.length;b++)this.toFront(a.elements[b])};this.getMousePoint=function(){return u};this.toBack=function(a){for(var b=0;b<p.length&&!a.equals(p[b]);b++);p.splice(b,1);p.splice(0,0,a);a instanceof c.Group&&this.__toBackGroup(a)};this.__toBackGroup=function(a){for(var b=0;b<a.elements.length;b++)this.toBack(a.elements[b])};
this.moveOnRAngle=function(a){J=a};this.moveOnGrid=function(a,b,c){B=a;null!=b&&(D.x=b);null!=c&&(D.y=c)};this.refresh=function(){for(var a=0;a<g.elements.length;a++)g.elements[a].invalidLayout()};this.setScale=function(a){l=a;for(var b=0;b<g.elements.length;b++)g.elements[b].setScale(a);g.refresh()};this.remove=function(a){if(a instanceof c.Group)for(var f=0;f<a.elements.length;f++)b(p,a.elements[f]),b(g.elements,a.elements[f]);b(g.elements,a);a instanceof c.LinkElement?b(n,a):a instanceof c.Tooltip?
b(v,a):b(p,a)};this.clear=function(){for(var a=0;a<g.elements.length;a++)g.elements[a].dispose();g.elements.splice(0);p.splice(0);n.splice(0);v.splice(0)};var n=[],p=[],v=[];this.add=function(a){-1==a.id&&a.setValue("id",F());g.elements.push(a);a instanceof c.LinkElement?n.push(a):a instanceof c.Tooltip?v.push(a):p.push(a);a.setParent(g)};this.setTooltip=function(a){v.push(a)};var x,y,r=[],w=null,t=null,E=!1;this.getHoverElement=function(){return t};this.getActionElement=function(){return w};this.getSelectedElement=
function(){return r};this.cancelSelected=function(){for(var a=0;a<r.length;a++)r[a].status=c.Status.None;r.splice(0)};this.cancelAction=function(){t=w=null};this.selectAll=function(){for(var a=0;a<p.length;a++)p[a].status=c.Status.Selected,r.push(p[a]);return r};var K=!1,G=new C;this.onmousedown=function(a){0==G.x-a.offsetX&&0==G.y-a.offsetY&&f(this.elements,a,t);if(0==a.button)if(K=!0,G.x=a.offsetX,G.y=a.offsetY,t){var b=t;if(0<r.length){for(var d=!1,e=0;e<r.length;e++)if(r[e].equals(b)){w=r[e];
d=!0;break}if(d)return x=a.offsetX,y=a.offsetY,B&&(z.x=a.offsetX,z.y=a.offsetY),w;g.cancelAction();g.cancelSelected()}else if(b.canEvent&&(b.canDrag||b.canSelect)){if(b.editMode==c.EditMode.Select)return r.push(b),w=b,b.status=c.Status.Selected,x=a.offsetX,y=a.offsetY,B&&(z.x=a.offsetX,z.y=a.offsetY),b;if(b.editMode>c.EditMode.Select&&(w=b,r.push(b),d=b.testNode(a.offsetX,a.offsetY)))return x=a.offsetX,y=a.offsetY,B&&(z.x=a.offsetX,z.y=a.offsetY),b.controlNode=d,b}else if(b.canEvent&&b.editMode==
c.EditMode.Select)return w=b}else g.cancelSelected();else{if(w)return w;if(t)return t}};this.onmousemove=function(a){this.stage.debugger.write("x:"+a.offsetX+",y:"+a.offsetY);u={x:a.offsetX,y:a.offsetY};var b=0,d=0;K&&(1<Math.abs(G.x-a.offsetX)||1<Math.abs(G.y-a.offsetY))&&(E=!0,g.stage.cursor="move");if(E&&0<r.length){for(var e=0;e<r.length;e++)if(r[e].editMode>c.EditMode.Select){if(b=a.offsetX/l,d=a.offsetY/l,r[e].controlNode){if(!r[e].canEdit)return;r[e]instanceof c.LineElement?r[e].controlNode.controlMode==
c.EndPointMode.Start?J?Math.abs(a.offsetX-r[e].endNode.x)>Math.abs(a.offsetY-r[e].endNode.y)?r[e].controlNode.move(a.offsetX,r[e].endNode.y):r[e].controlNode.move(r[e].endNode.x,a.offsetY):r[e].controlNode.move(a.offsetX/l,a.offsetY/l):r[e].controlNode.controlMode==c.EndPointMode.End&&(J?Math.abs(a.offsetX-r[e].startNode.x)>Math.abs(a.offsetY-r[e].startNode.y)?r[e].controlNode.move(a.offsetX,r[e].startNode.y):r[e].controlNode.move(r[e].startNode.x,a.offsetY):r[e].controlNode.move(a.offsetX/l,a.offsetY/
l)):r[e].controlNode.move(a.offsetX-x,a.offsetY-y)}}else{var k=r[e];!r[e].canDrag||r[e]instanceof c.LinkElement||(r[e].group&&(k=r[e].group),k&&B?Math.abs(a.offsetX-x)>Math.abs(a.offsetY-y)?a.offsetX-z.x>D.x*l?(b=D.x,z.x=a.offsetX):a.offsetX-z.x<(0-D.x)*l&&(b=0-D.x,z.x=a.offsetX):a.offsetY-z.y>D.y*l?(d=D.y,z.y=a.offsetY):a.offsetY-z.y<(0-D.y)*l&&(d=0-D.y,z.y=a.offsetY):(b=parseFloat(a.offsetX-x)/l,d=parseFloat(a.offsetY-y)/l,J&&(Math.abs(a.offsetX-x)>Math.abs(a.offsetY-y)?d=0:b=0)),k instanceof c.LineElement?
_dragEle.offset(a.offsetX-x,a.offsetY-y):k instanceof c.Group?k.offset(b,d):(B&&(k.x=10*Math.ceil(k.x/10),k.y=10*Math.ceil(k.y/10)),k.x+=b,k.y+=d,k.status=c.Status.Draging))}x=a.offsetX;y=a.offsetY}b=t;if(null!=t){t.status=c.Util.xorEnum(t.status,c.Status.Hover);if(t.group){if(0==r.length)for(d=0;d<this.elements.length;d++)this.elements[d]instanceof c.Group&&(this.elements[d].status=c.Status.None);t.group.status=c.Util.xorEnum(t.group.status,c.Status.Hover)}if(g.mode==c.LayerMode.Action||g.mode==
c.LayerMode.Force)t=null}w||(f(p,a,b)||f(n,a,b),b&&(!t||t&&!t.equals(b))&&b.fireLeave(),!t||b&&t.equals(b)||t.fireHover(),g.stage.cursor=t?"pointer":"default")};this.resetElement=function(){for(var a=0;a<this.elements.length;a++)this.elements[a].Status=c.Status.None};this.onmouseup=function(a,b){K=!1;r=[];var d=0;E?(w&&(d=1,w.status=c.Status.None,w.controlNode=null),E=!1):(null==w&&(w=t),w&&(d=2,w.status=c.Status.None,w.controlNode=null,0==a.button&&w.canSelect&&(c.Util.orEnum(g.scene.mode,c.SceneMode.SingleSelect)||
c.Util.orEnum(g.scene.mode,c.SceneMode.MultipleSelect))&&(w.status=c.Status.Selected,r.push(w)),w.fireClick(a),w.events.hits&&w.fireHit({x:a.offsetX,y:a.offsetY})));if(g.mode==c.LayerMode.Action&&b)for(a=0;a<g.elements.length;a++){var f=g.elements[a];null==f.group&&f.inRect(b.x,b.y,b.width,b.height)?(f.status=c.Status.Selected,r.push(f)):f.status=c.Status.None}return d};this.preRender=function(a){d(p,a);d(n,a)};this.render=function(a){for(var b=0;b<n.length;b++)m(n[b])&&h(n[b],a);for(b=0;b<p.length;b++)m(p[b])&&
h(p[b],a);for(b=0;b<v.length;b++)m(v[b])&&h(v[b],a)};this.dispose=function(){if(this.isdisposed)console.log("object was disposed");else{for(var a=0;a<this.elements.length;a++)this.elements[a].dispose(),this.elements[a]=null,this.elements=[];this.isdisposed=!0}}}function a(){d.call(this);this.type="lion.BackgroundLayer";this.__data__.backgroundColor="#eeeeee";var a=this,b;this.renderBackground=function(c){this.invalid||!b?(c.fillStyle=a.backgroundColor,c.fillRect(0,0,a.width,a.height),b=c.getImageData(0,
0,a.width,a.height),this.setValue("invalid",!1)):c.putImageData(b,0,0)}}function b(){d.call(this,c.LayerMode.Virtual);this.type="lion.VirtualLayer";var a=this,b=null,e=c.LayerMode.Virtual;this.getVirtualRect=function(){if(b)return b.drawBounds};this.onmousedown=function(d){0==d.button&&c.Util.andEnum(a.scene.mode,c.SceneMode.MultipleSelect)&&(b||(b=new c.RectElement,a.add(b,c.LayerMode.Virtual)),b.x=d.offsetX,b.y=d.offsetY,b.setParent(a),b.backgroundColor="rgba(175,175,175,0.2)",b.width=0,b.height=
0,b.borderColor="#333333",b.borderSize=1)};this.onmousemove=function(a){e==c.LayerMode.Virtual&&b&&(b.width=a.offsetX-b.x,b.height=a.offsetY-b.y)};this.onmouseup=function(c,d){b&&(a.remove(b),b=null);a.clear()}}d.prototype=new c.Element(!0);d.prototype.setParent=function(a){c.Element.prototype.setParent.call(this,a);this.stage=a.stage;this.scene=a;for(a=0;a<this.elements.length;a++)this.elements[a].setParent(this)};d.prototype.findElementById=function(a){for(var b=0;b<this.elements.length;b++)if(this.elements[b].id==
a)return this.elements[b]};d.prototype.onserialize=function(a,b){var c="";if("elements"==a){c+='"'+a+'":[';for(a=0;a<b.length;a++)c+=b[a].serialize()+",";","==c[c.length-1]&&(c=c.substr(0,c.length-1));c+="]"}return c};d.prototype.ondeserialize=function(a,b){if("elements"==a){this._elements_=[];for(a=0;a<b.length;a++)this._elements_.push(b[a]);return!0}};d.prototype.enddeserialize=function(){if(this._elements_)for(var a=0;a<this._elements_.length;a++){var b=c.Element.deserialize(this._elements_[a]);
this.add(b);b.enddeserialize()}delete this._elements_};c.Layer=d;a.prototype=new d(!0);Object.defineProperties(a.prototype,{backgroundColor:{get:function(){return this.getValue("backgroundColor")},set:function(a){this.setValue("backgroundColor",a);this.invalidLayout()},enumerable:!0}});c.BackgroundLayer=a;b.prototype=new d(!0);c.VirtualLayer=b}(l);!function(c){function d(a){var b,d;function k(a){return a==c.LayerMode.Virtual?h.layers.virtual:a==c.LayerMode.Force?h.layers.force:a==c.LayerMode.Background?
h.layers.background:h.layers.action}function e(a,b){b==c.LayerMode.Force?h.layers.force.add(a):b==c.LayerMode.Background?h.layers.background.add(a):b==c.LayerMode.Virtual?h.layers.virtual.add(a):h.layers.action.add(a);if(m&&!(a instanceof c.BirdsEye))a.onLayout(m.invalidLayout,m)}c.Element.call(this);this.type="lion.Scene";this.layers={};var q=this.__data__;q.x=0;q.y=0;q.mode=c.SceneMode.Normal;var m;this.showBirdsEye=function(){m=new c.BirdsEye;m.canDrag=!1;e(m,c.LayerMode.Force)};var h=this;this.invalidLayout=
function(a){c.Element.prototype.invalidLayout.call(this,a);for(var b in this.layers)this.layers[b].invalidLayout("bounds")};this.setLayer=function(a,b){if(a==c.LayerMode.Virtual){var d=b?b:new c.VirtualLayer;h.layers.virtual=d}else a==c.LayerMode.Force?(d=b?b:new c.Layer(a),h.layers.force=d):a==c.LayerMode.Action?(d=b?b:new c.Layer(a),h.layers.action=d):a==c.LayerMode.Background&&(d=b?b:new c.BackgroundLayer,h.layers.background=d);d.setValue("id",F());d.setParent(h)};this.setScale=function(a,b){b?
b==c.LayerMode.Action?h.layers.action.setScale(a):b==c.LayerMode.Background&&h.layers.background.setScale(a):(h.layers.action.setScale(a),h.layers.background.setScale(a))};this.addElement=function(a,b){e(a,b)};this.foreach=function(a,b){a=k(a);for(var c=0;c<a.elements.length;c++)b(a.elements[c])};this.find=function(a,b){a=k(a);for(var c=0;c<a.elements.length;c++)if(b(a.elements[c]))return a.elements[c];return null};this.clear=function(a){a==c.LayerMode.Force?h.layers.force.clear():a==c.LayerMode.Background?
h.layers.background.clear():h.layers.action.clear()};this.remove=function(a,b){b==c.LayerMode.Force?h.layers.force.remove(a):b==c.LayerMode.Background?h.layers.background.remove(a):h.layers.action.remove(a)};this.preRender=function(a){h.layers.background.preRender(a);h.layers.action.preRender(a);h.layers.virtual.preRender(a);h.layers.force.preRender(a)};this.render=function(a){h.layers.background.render(a);h.layers.action.render(a);h.layers.virtual.render(a);h.layers.force.render(a)};this.renderBackground=
function(a){h.layers.background.renderBackground(a)};this.__onmousedown=function(a){h.mode==c.SceneMode.Move&&(b=!0,g=!1,d=a.clientX,l=a.clientY);var f=h.layers.force.onmousedown(a),e=null;if(f)e=h.layers.force;else if(f=h.layers.action.onmousedown(a))e=h.layers.action;else h.layers.virtual.onmousedown(a);for(var k=0;k<h.events.mousedown.length;k++)h.events.mousedown[k](a,h,f,e?e.mode:null)};var g=b=!1;var l=d=0;this.__onmousemove=function(a){if(h.mode==c.SceneMode.Move&&(b&&3<Math.abs(d-a.offsetX)&&
3<Math.abs(l-a.offsetY)&&(g=!0),g)){h.x+=a.clientX-d;h.y+=a.clientY-l;d=a.clientX;l=a.clientY;h.layers.action.refresh();h.layers.background.refresh();return}h.layers.force.onmousemove(a);h.layers.virtual.onmousemove(a);h.layers.action.onmousemove(a);if(p||u){var f=h.layers.force.getHoverElement();f||(f=h.layers.action.getHoverElement());for(var e=0;e<h.events.mousemove.length;e++)h.events.mousemove[e](a,f)}};this.__onmouseup=function(a){var c=h.layers.virtual.getVirtualRect();h.layers.virtual.onmouseup(a);
h.layers.force.onmouseup(a);var d=h.layers.action.onmouseup(a,c);if(n||u){var f=h.layers.force.getActionElement();f||(f=h.layers.action.getActionElement());for(c=0;c<h.events.mouseup.length;c++)h.events.mouseup[c](a,f);if(1!=d&&!g)for(c=0;c<h.events.click.length;c++)h.events.click[c](a,f)}b=g=!1;if((a=h.layers.action.getSelectedElement())&&0<a.length)for(c=0;c<h.events.selected.length;c++)h.events.selected[c](h.layers.action,a);h.layers.virtual.cancelAction();h.layers.force.cancelAction();h.layers.action.cancelAction()};
this.__ondblclick=function(a){};this.__onkeypress=function(a){for(var b=0;b<h.events.keypress.length;b++)h.events.keypress[b](a)};h.events.selected=[];h.events.mousedown=[];h.events.mousemove=[];h.events.mouseup=[];h.events.click=[];h.events.keypress=[];var p,n,u;this.onClick=function(a){u=a;h.events.click.push(a)};this.onMouseDown=function(a){h.events.mousedown.push(a)};this.onMouseMove=function(a){p=a;h.events.mousemove.push(a)};this.onMouseUp=function(a){n=a;h.events.mouseup.push(a)};this.onKeyPress=
function(a){h.events.keypress.push(a)};this.onSelectedElements=function(a){h.events.selected.push(a)};this.getSelectedElements=function(a){a=k(a).getSelectedElement();for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};this.onserialize=function(a,b){b="";"layers"==a&&(b=b+('"'+a+'":{')+('"background":'+h.layers.background.serialize()+","),b+='"action":'+h.layers.action.serialize()+",",b+='"force":'+h.layers.force.serialize(),b+="}");return b};this.ondeserialize=function(a,b){return"layers"==a?(this.setLayer(c.LayerMode.Force,
c.Element.deserialize(b.force)),this.setLayer(c.LayerMode.Action,c.Element.deserialize(b.action)),this.setLayer(c.LayerMode.Background,c.Element.deserialize(b.background)),this.setLayer(c.LayerMode.Virtual),!0):!1};this.enddeserialize=function(){h.layers.background.enddeserialize();h.layers.action.enddeserialize();h.layers.force.enddeserialize()};this.dispose=function(){this.isdisposed?console.warn("object was disposed"):(this.layers.virtual.dispose(),this.layers.force.dispose(),this.layers.action.dispose(),
this.layers.background.dispose(),this.isdisposed=!0)};this.toCenter=function(a){var b=h.stage.height/2-a.drawBounds.center.y;h.x=h.stage.width/2-a.drawBounds.center.x;h.y=b;h.layers.action.refresh();h.layers.background.refresh()};a||(this.setLayer(c.LayerMode.Force),this.setLayer(c.LayerMode.Action),this.setLayer(c.LayerMode.Background),this.setLayer(c.LayerMode.Virtual))}d.prototype=new c.Element(!0);Object.defineProperties(d.prototype,{width:{get:function(){return!this.getValue("width")&&this.stage?
this.stage.width:this.getValue("width")},set:function(a){this.setValue("width",a);this.invalidLayout("bounds");for(var b in this.layers)this.layers[b].invalidLayout("bounds")},enumerable:!0},height:{get:function(){return!this.getValue("height")&&this.stage?this.stage.height:this.getValue("height")},set:function(a){this.setValue("height",a);this.invalidLayout("bounds");for(var b in this.layers)this.layers[b].invalidLayout("bounds")},enumerable:!0},mode:{get:function(){return this.getValue("mode")},
set:function(a){this.setValue("mode",a);this.invalidLayout()},enumerable:!0},x:{get:function(){return this.getValue("x")},set:function(a){this.setValue("x",a);this.invalidLayout("bounds")},enumerable:!0},y:{get:function(){return this.getValue("y")},set:function(a){this.setValue("y",a);this.invalidLayout("bounds")},enumerable:!0}});d.prototype.setParent=function(a){c.Element.prototype.setParent.call(this,a);this.stage=a;this.layers.virtual.setParent(this);this.layers.force.setParent(this);this.layers.action.setParent(this);
this.layers.background.setParent(this)};c.Scene=d}(l);!function(c){function d(a){c.Element.call(this,a);this.type="lion.GeoElement";a=this.__data__;a.x=0;a.y=0;a.borderColor="#333333";a.borderSize=0;a.backgroundColor="#dddddd";a.scale=1;a.shadow=null;a.backgroundImageUrl=null;a.visible=!0;a.highlightColor="rgba(255,255,255,0.7)";a.status=c.Status.None;a.canDrag=!0;a.canEdit=!0;a.canSelect=!0;a.canEvent=!0;a.backgroundImage=null;a.scene=null;a.layer=null;a.drawBounds=new A;a.tooltip=null;a.lines=[];
this.animations=[];this.events.hover=[];this.events.leave=[];this.events.layout=[];this.events.click=[];this.events.rclick=[];this.events.hits=[]}d.prototype=new c.Element(!0);d.prototype.initialize=function(){c.Element.prototype.initialize.call(this)};Object.defineProperties(d.prototype,{width:{get:function(){return this.getValue("width")},set:function(a){this.setValue("width",a);this.invalidLayout("bounds")},enumerable:!0},height:{get:function(){return this.getValue("height")},set:function(a){this.setValue("height",
a);this.invalidLayout("bounds")},enumerable:!0},x:{get:function(){return this.getValue("x")},set:function(a){this.setValue("x",a);this.invalidLayout("bounds")},enumerable:!0},y:{get:function(){return this.getValue("y")},set:function(a){this.setValue("y",a);this.invalidLayout("bounds")},enumerable:!0},center:{get:function(){return{x:this.getValue("x")+this.getValue("width")/2,y:this.getValue("y")+this.getValue("height")/2}},enumerable:!1},backgroundColor:{get:function(){return this.getValue("backgroundColor")},
set:function(a){this.setValue("backgroundColor",a);a instanceof c.Gradient&&a.setOwner(this);this.invalidLayout()},enumerable:!0},borderColor:{get:function(){return this.getValue("borderColor")},set:function(a){this.setValue("borderColor",a);this.invalidLayout()},enumerable:!0},borderSize:{get:function(){return this.getValue("borderSize")},set:function(a){this.setValue("borderSize",a);this.invalidLayout()},enumerable:!0},scale:{get:function(){return this.getValue("scale")},set:function(a){this.setValue("scale",
a);this.invalidLayout("bounds")},enumerable:!0},shadow:{get:function(){return this.getValue("shadow")},set:function(a){this.setValue("shadow",a);this.invalidLayout()},enumerable:!0},visible:{get:function(){return this.getValue("visible")},set:function(a){this.setValue("visible",a);this.invalidLayout()},enumerable:!0},backgroundImage:{get:function(){return this.getValue("backgroundImage")},set:function(a){this.setValue("backgroundImage",a);this.invalidLayout()}},backgroundImageUrl:{get:function(){return this.getValue("backgroundImageUrl")},
set:function(a){this.setValue("backgroundImageUrl",a);a?(a=new Image,a.src=this.backgroundImageUrl,this.setValue("backgroundImage",a)):this.setValue("backgroundImage",null);this.invalidLayout()},enumerable:!0},highlightColor:{get:function(){return this.getValue("highlightColor")},set:function(a){this.setValue("highlightColor",a)},enumerable:!0},scene:{get:function(){return this.getValue("scene")},set:function(a){this.setValue("scene",a)},enumerable:!1},layer:{get:function(){return this.getValue("layer")},
set:function(a){this.setValue("layer",a)},enumerable:!1},drawBounds:{get:function(){return this.getValue("drawBounds")},enumerable:!1},status:{get:function(){return this.getValue("status")},set:function(a){this.setValue("status",a)},enumerable:!1},canDrag:{get:function(){return this.getValue("canDrag")},set:function(a){this.setValue("canDrag",a)},enumerable:!0},canEdit:{get:function(){return this.getValue("canEdit")},set:function(a){this.setValue("canEdit",a)},enumerable:!0},canSelect:{get:function(){return this.getValue("canSelect")},
set:function(a){this.setValue("canSelect",a)},enumerable:!0},canEvent:{get:function(){return this.getValue("canEvent")},set:function(a){this.setValue("canEvent",a)},enumerable:!0},tooltip:{get:function(){return this.getValue("tooltip")},set:function(a){this.setValue("tooltip",a);this.invalidLayout()},enumerable:!0},lines:{get:function(){return this.getValue("lines")},set:function(a){this.setValue("lines",a);this.invalidLayout()},enumerable:!0}});d.prototype.invalidLayout=function(a){c.Element.prototype.invalidLayout.call(this,
a);for(var b=0;b<this.lines.length;b++)this.lines[b].invalidLayout(a)};d.prototype.onClick=function(a){this.events.click.push(a)};d.prototype.onRightClick=function(a){this.events.rclick.push(a)};d.prototype.onHover=function(a){this.events.hover.push(a)};d.prototype.onLeave=function(a){this.events.leave.push(a)};d.prototype.onLayout=function(a,b){this.events.layout.push({object:b,func:a})};d.prototype.fireHover=function(a){for(a=0;a<this.events.hover.length;a++)this.events.hover[a](this)};d.prototype.fireLeave=
function(a){for(a=0;a<this.events.leave.length;a++)this.events.leave[a](this)};d.prototype.fireClick=function(a){var b=!0;if(0==a.button)for(a=0;a<this.events.click.length;a++){var c=this.events.click[a].call(this,this,this.layer);void 0!=c&&0==c&&(b=!1)}else if(2==a.button)for(a=0;a<this.events.rclick.length;a++)c=this.events.rclick[a].call(this,this,this.layer),void 0!=c&&0==c&&(b=!1);return b};d.prototype.fireLayout=function(){for(var a=0;a<this.events.layout.length;a++)c.Util.is(this.events.layout[a],
"object")&&this.events.layout[a].func.call(this.events.layout[a].object)};d.prototype.onHit=function(a){this.events.hits.push(a)};d.prototype.fireHit=function(a){for(var b=0;b<this.events.hits.length;b++)this.events.hits[b]({x:a.x-this.drawBounds.x,y:a.y-this.drawBounds.y})};d.prototype.inRect=function(a,b,d,k){return c.Util.inRect(a,b,d,k,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height)};d.prototype.setParent=function(a){c.Element.prototype.setParent.call(this,a);
this.layer=a instanceof c.Layer?a:a.layer;this.scene=a instanceof c.Scene?a:a.scene;this.stage=a.stage;this.tooltip&&this.tooltip.setParent(this)};d.prototype.setTooltip=function(a){this.tooltip||(this.tooltip=new c.Tooltip,this.tooltip.setParent(this));c.Util.isNullOrWhitespace(a)?(this.tooltip.visible=!1,this.tooltip.text=""):(this.tooltip.visible=!0,this.tooltip.text=a);this.layer.setTooltip(this.tooltip);return this.tooltip};d.prototype.setScale=function(a){this.scale=a};d.prototype.updateBounds=
function(a){a=this.parent?this.parent.drawBounds.y:0;this.drawBounds.x=this.x*this.scale+(this.parent?this.parent.drawBounds.x:0);this.drawBounds.y=this.y*this.scale+a;this.drawBounds.width=this.width*this.scale;this.drawBounds.height=this.height*this.scale;this.drawBounds.calc();this.fireLayout()};d.prototype.testPoint=function(a,b){return c.Util.inRect(this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height,a,b)};d.prototype.preRender=function(a){a=this.drawBounds;this.points=
[];this.points.push({x:a.x,y:a.y});this.points.push({x:a.x+a.width,y:a.y});this.points.push({x:a.x+a.width,y:a.y+a.height});this.points.push({x:a.x,y:a.y+a.height})};d.prototype.renderBackground=function(a){a.fillStyle=this.backgroundColor;a.beginPath()};d.prototype.render=function(a){a.moveTo(this.points[0].x,this.points[0].y);for(var b=1;b<this.points.length;b++)a.lineTo(this.points[b].x,this.points[b].y);a.closePath();this.backgroundColor&&a.fill();this.backgroundImage&&a.drawImage(this.backgroundImage,
this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height);0<this.borderSize&&(a.strokeStyle=this.borderColor,a.lineWidth=this.borderSize,a.stroke());c.Util.andEnum(this.status,c.Status.Selected)&&(a.fillStyle="rgba(255,255,255,0.7)",a.fill())};d.prototype.renderHighLight=function(a){if(this.highlightColor){a.fillStyle=this.highlightColor;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var b=1;b<this.points.length;b++)a.lineTo(this.points[b].x,this.points[b].y);
a.closePath();a.fill()}};d.prototype.renderTooltip=function(a){this.tooltip.visible&&this.tooltip.render(a)};d.prototype.renderLine=function(a,b,c,d){if(d==l.LineStyle.Dotted){d=Math.floor(Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2))/5);for(var f=0;f<d;f++)a[0==f%2?"moveTo":"lineTo"](b.x+(c.x-b.x)/d*f,b.y+(c.y-b.y)/d*f);a.stroke()}};d.prototype.setAnimation=function(a){a.setElement(this);a.animationId=parseInt(1E5*Math.random());x[a.animationId]=a;this.animations.push(a);return a.animationId};
d.prototype.removeAnimation=function(a){x[a].enable=!1;delete x[a]};d.prototype.enableAnimation=function(a,b){x[a].enable=b};d.prototype.enableAllAnimation=function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].enable=a};d.prototype.clearAnimation=function(){for(var a=0;a<this.animations.length;a++)this.animations[a].enable=!1,delete x[this.animations[a].animationId];this.animations=[]};d.prototype.dispose=function(){this.isdisposed||(this.events.click.splice(0),this.events.hits.splice(0),
this.events.hover.splice(0),this.events.layout.splice(0),this.clearAnimation(),this.isdisposed=!0)};c.GeoElement=d}(l);!function(c){function d(a){a||(c.GeoElement.call(this,a),this.type="lion.BaseTextElement",a=this.__data__,a.allowMultiline=!1,a.allowWrap=!0,a.foreColor="#000000",a.fontSize=15,a.isGraphicText=!1,a.fontFamliy="Arial",a.textStyle=c.TextStyle.None,a.align=c.Align.Center,a.text="",a.textRect=null,a.textlines=[],a.pointLines=[],a.lineHeight=0)}d.prototype=new c.GeoElement;Object.defineProperties(d.prototype,
{allowMultiline:{get:function(){return this.getValue("allowMultiline")},set:function(a){this.setValue("allowMultiline",a);this.invalidLayout()},enumerable:!0},allowWrap:{get:function(){return this.getValue("allowWrap")},set:function(a){this.setValue("allowWrap",a);this.invalidLayout()},enumerable:!0},foreColor:{get:function(){return this.getValue("foreColor")},set:function(a){this.setValue("foreColor",a);this.invalidLayout()},enumerable:!0},fontSize:{get:function(){return this.getValue("fontSize")},
set:function(a){this.setValue("fontSize",a);this.invalidLayout()},enumerable:!0},isGraphicText:{get:function(){return this.getValue("isGraphicText")},set:function(a){this.setValue("isGraphicText",a);this.invalidLayout()},enumerable:!0},fontFamliy:{get:function(){return this.getValue("fontFamliy")},set:function(a){this.setValue("fontFamliy",a);this.invalidLayout()},enumerable:!0},align:{get:function(){return this.getValue("align")},set:function(a){this.setValue("align",a);this.invalidLayout()},enumerable:!0},
text:{get:function(){return this.getValue("text")},set:function(a){this.setValue("text",a);this.invalidLayout()},enumerable:!0},drawText:{get:function(){return this.isGraphicText?this.stage.notifyCmd("getGraphicText",{id:this.id}):this.text},enumerable:!1},textStyle:{get:function(){return this.getValue("textStyle")},set:function(a){this.setValue("textStyle",a);this.invalidLayout()},enumerable:!0},textlines:{get:function(){return this.getValue("textlines")},enumerable:!1},textRect:{get:function(){return this.getValue("textRect")},
set:function(a){this.setValue("textRect",a)},enumerable:!1},pointLines:{get:function(){return this.getValue("pointLines")},enumerable:!1},lineHeight:{get:function(){return this.getValue("lineHeight")},set:function(a){this.setValue("lineHeight",a)},enumerable:!1}});d.prototype.appendLine=function(a){this.text=this.text&&""!=this.text?this.text+("\r\n"+a):a};d.prototype.getTextRect=function(){return this.textRect};d.prototype.getLineHeight=function(){return this.lineHeight};d.prototype.measureLines=
function(a,b){function d(a,b,d,f){var g=b.measureText(d[f]).width;b=b.measureText("\u7530").width;a.lineHeight=b;var h=new A;if(null!=a.drawBounds){k=g;e=b;a.allowMultiline&&(k<g&&(k=g),e=d.length*b);if(0==a.drawBounds.width&&0==a.drawBounds.height){var q=a.drawBounds.x+3;a=a.drawBounds.y+f*b+b+3}else a.align==c.Align.Center?(q=a.drawBounds.x+(a.drawBounds.width-k)/2,a=a.drawBounds.y+(a.drawBounds.height-e)/2+f*b+b-5):a.align==c.Align.TopLeft?(q=a.drawBounds.x,a=a.drawBounds.y-(d.length-1-f)*b-5):
a.align==c.Align.TopMiddle?(q=a.drawBounds.x+(a.drawBounds.width-k)/2,a=a.drawBounds.y-(d.length-1-f)*b-5):a.align==c.Align.TopRight?(q=a.drawBounds.x+(a.drawBounds.width-k),a=a.drawBounds.y-(d.length-1-f)*b-5):a.align==c.Align.MiddleLeft?(q=a.drawBounds.x+2,a=a.drawBounds.y+(a.drawBounds.height-e)/2+f*b+b-5):a.align==c.Align.MiddleRight?(q=a.drawBounds.x+(a.drawBounds.width-k)-2,a=a.drawBounds.y+(a.drawBounds.height-e)/2+f*b+b-5):a.align==c.Align.BottomLeft?(q=a.drawBounds.x,a=a.drawBounds.y+a.drawBounds.height+
(f+1)*b):a.align==c.Align.BottomMiddle?(q=a.drawBounds.x+(a.drawBounds.width-k)/2,a=a.drawBounds.y+a.drawBounds.height+(f+1)*b):a.align==c.Align.BottomRight?(q=a.drawBounds.x+(a.drawBounds.width-k)-2,a=a.drawBounds.y+a.drawBounds.height+(f+1)*b):(q=a.drawBounds.x,a=a.drawBounds.y);h.x=q;h.y=a}else h.x=a.x,h.y=a.y-b;h.width=g;h.height=b;return h}var k=0,e=0;if(this.allowMultiline){for(var q=[],m=0;m<b.length;m++){var h=d(this,a,b,m);q.push(h);this.pointLines.push({x:h.x,y:h.y})}return n(q)}return d(this,
a,b,0)};d.prototype.updateBounds=function(a){this.isGraphicText&&this.stage.notifyCmd("updateGraphicText",{font:this.fontFamliy,id:this.id,text:this.text,size:this.fontSize});c.GeoElement.prototype.updateBounds.call(this,a)};d.prototype.measureText=function(a){if(!c.Util.isNullOrWhitespace(this.drawText)){this.pointLines.splice(0);a.font=parseInt(this.fontSize*this.scale)+"px "+this.fontFamliy;var b=this.textlines;b.splice(0);this.allowMultiline?E(b,this.drawText.split("\r\n")):E(b,[this.drawText]);
this.textRect=this.measureLines(a,this.textlines)}return this.textRect};d.prototype.renderText=function(a,b,d,k){b=void 0!=b?b:this.drawText;d=void 0!=d?d:this.drawBounds;k=void 0!=k?k:this.foreColor;a.shadowBlur=0;if(!c.Util.isNullOrWhitespace(b))if(a.font=parseInt(this.fontSize*this.scale)+"px "+this.fontFamliy,a.fillStyle=k,this.allowMultiline)for(k=0;k<this.textlines.length;k++)a.fillText(this.textlines[k],this.pointLines[k].x,this.pointLines[k].y);else try{a.fillText(b,d.x,d.y)}catch(e){console.log(e)}};
c.BaseTextElement=d}(l);!function(c){function d(){c.GeoElement.call(this);this.type="lion.Group";var a=this.__data__;a.editMode=c.EditMode.Select;a.elements=[]}d.prototype=new c.GeoElement;Object.defineProperties(d.prototype,{elements:{get:function(){return this.getValue("elements")},enumerable:!0},editMode:{get:function(){return this.getValue("editMode")},enumerable:!1}});d.prototype.offset=function(a,b){if(0<this.points.length)for(var d=0;d<this.elements.length;d++)this.elements[d]instanceof c.LineElement?
this.elements[d].offset(a,b):(this.elements[d].x+=a,this.elements[d].y+=b)};d.prototype.move=function(a,b){this.offset(a-this.drawBounds.x,b-this.drawBounds.y)};d.prototype.add=function(a){a.group=this;this.elements.push(a)};d.prototype.updateBounds=function(a){a=p(this.elements);this.drawBounds.x=a.x;this.drawBounds.y=a.y;this.drawBounds.width=a.width;this.drawBounds.height=a.height};d.prototype.renderBackground=function(a){};d.prototype.renderHighLight=function(a){a.lineWidth=1;a.strokeStyle="red";
for(var b=0;b<this.points.length-1;b++)a.beginPath(),this.renderLine(a,this.points[b],this.points[b+1],c.LineStyle.Dotted);a.beginPath();this.renderLine(a,this.points[this.points.length-1],this.points[0],c.LineStyle.Dotted)};d.prototype.render=function(a){};d.prototype.onserialize=function(a,b){if("elements"==a){a='"elements":[';for(b=0;b<this.elements.length;b++)a+=this.elements[b].id+",";","==a[a.length-1]&&(a=a.substr(0,a.length-1));return a+"]"}};d.prototype.ondeserialize=function(a,b){if("elements"==
a){this._elements_=[];for(a=0;a<b.length;a++)this._elements_[a]=b[a];return!0}};d.prototype.enddeserialize=function(){for(var a=0;a<this._elements_.length;a++){var b=this.layer.findElementById(this._elements_[a]);b&&this.add(b)}delete this._elements_};c.Group=d}(l);!function(c){function d(a){c.BaseTextElement.call(this,a);this.type="lion.Node";a=this.__data__;a.shownodes=null;a.displayNodes=[];a.controlNode=null;a.nodes=[];a.hoverNode=null;a.editMode=c.EditMode.Select}d.prototype=new c.BaseTextElement(!0);
Object.defineProperties(d.prototype,{displayNodes:{get:function(){return this.getValue("displayNodes")},enumerable:!1},controlNode:{get:function(){return this.getValue("controlNode")},set:function(a){this.setValue("controlNode",a)},enumerable:!1},shownodes:{get:function(){return this.getValue("shownodes")},set:function(a){this.setValue("shownodes",a)},enumerable:!1},nodes:{get:function(){return this.getValue("nodes")},enumerable:!0},hoverNode:{get:function(){return this.getValue("hoverNode")},set:function(a){this.setValue("hoverNode",
a)},enumerable:!1},editMode:{get:function(){return this.getValue("editMode")},enumerable:!1}});d.prototype.setParent=function(a){c.BaseTextElement.prototype.setParent.call(this,a)};d.prototype.testNode=function(a,b){for(var c=0;c<this.nodes.length;c++)if(this.nodes[c].testPoint(a,b))return this.hoverNode=this.nodes[c];this.hoverNode=null};d.prototype.setScale=function(a){c.BaseTextElement.prototype.setScale.call(this,a);if(this.nodes)for(var b=0;b<this.nodes.length;b++)this.nodes[b].setScale(a)};
d.prototype.updateBounds=function(a){c.BaseTextElement.prototype.updateBounds.call(this);for(var b=0;b<this.nodes.length;b++)this.nodes[b].updateBounds(a)};d.prototype.invalidLayout=function(a){c.BaseTextElement.prototype.invalidLayout.call(this,a);for(var b=0;b<this.nodes.length;b++)this.nodes[b].invalidLayout(a);this.group&&this.group.invalidLayout(a)};d.prototype.setEditMode=function(a){this.canEdit&&this.canEvent&&(this.setValue("editMode",a),this.editMode>c.EditMode.Select&&(this.shownodes=1,
this.invalidLayout()))};d.prototype.buildNodes=function(){if(this.shownodes&&(this.initNodes(),0==this.displayNodes.length))if(1==this.shownodes)E(this.displayNodes,this.nodes);else{this.displayNodes=[];for(var a=0;a<this.shownodes.length;a++)this.displayNodes.push(this.getNode(this.shownodes[a]))}};d.prototype.showNodes=function(a){this.shownodes=a?a:1;this.invalidLayout()};d.prototype.getNode=function(a){0==this.nodes.length&&this.initNodes();for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].controlMode==
a)return this.nodes[b]};d.prototype.resetNodeLocation=function(a){a.controlMode==c.EndPointMode.TopLeft?(a.x=-4,a.y=-4):a.controlMode==c.EndPointMode.TopRight?(a.x=this.width-4,a.y=-4):a.controlMode==c.EndPointMode.BottomLeft?(a.x=-4,a.y=this.height-4):a.controlMode==c.EndPointMode.BottomRight?(a.x=this.width-4,a.y=this.height-4):a.controlMode==c.EndPointMode.MiddleTop?(a.x=this.width/2-4,a.y=-4):a.controlMode==c.EndPointMode.MiddleLeft?(a.x=-4,a.y=this.height/2-4):a.controlMode==c.EndPointMode.MiddleRight?
(a.x=this.width-4,a.y=this.height/2-4):a.controlMode==c.EndPointMode.MiddleBottom?(a.x=this.width/2-4,a.y=this.height-4):a.controlMode==c.EndPointMode.Center&&(a.x=this.width/2-4,a.y=this.height/2-4)};d.prototype.hideNodes=function(a){this.displayNodes.splice(0);this.shownodes=0;this.invalidLayout()};d.prototype.renderNodes=function(a){for(var b=0;b<this.displayNodes.length;b++)this.displayNodes[b].renderBackground(a),this.displayNodes[b].render(a)};d.prototype.renderHoverNode=function(a){this.hoverNode&&
this.hoverNode.renderHighLight(a)};d.prototype.initNodes=function(a){if(0==this.nodes.length){if(!a||a&&-1<a.indexOf(c.EndPointMode.TopLeft)){var b=new c.EndPoint(this);b.scale=this.scale;b.controlMode=c.EndPointMode.TopLeft;b.x=-4;b.y=-4;this.nodes.push(b)}if(!a||a&&-1<a.indexOf(c.EndPointMode.TopRight))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.TopRight,b.x=this.width-4,b.y=-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.BottomLeft))b=new c.EndPoint(this),
b.scale=this.scale,b.controlMode=c.EndPointMode.BottomLeft,b.x=-4,b.y=this.height-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.BottomRight))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.BottomRight,b.x=this.width-4,b.y=this.height-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.MiddleTop))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.MiddleTop,b.x=this.width/2-4,b.y=-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.MiddleLeft))b=
new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.MiddleLeft,b.x=-4,b.y=this.height/2-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.MiddleRight))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.MiddleRight,b.x=this.width-4,b.y=this.height/2-4,this.nodes.push(b);if(!a||a&&-1<a.indexOf(c.EndPointMode.MiddleBottom))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.MiddleBottom,b.x=this.width/2-4,b.y=this.height-4,this.nodes.push(b);
if(!a||a&&-1<a.indexOf(c.EndPointMode.Center))b=new c.EndPoint(this),b.scale=this.scale,b.controlMode=c.EndPointMode.Center,b.x=this.width/2-4,b.y=this.height/2-4,this.nodes.push(b);for(a=0;a<this.nodes.length;a++)this.nodes[a].setValue("id",F(this.nodes)),this.nodes[a].setParent(this)}};d.prototype.dispose=function(){if(!this.isdisposed){for(var a=0;a<this.nodes.length;a++)this.nodes[a].dispose(),this.nodes[a]=null;this.nodes.splice(0);c.BaseTextElement.prototype.dispose.call(this);this.isdisposed=
!0}};c.NodeElement=d}(l);!function(c){function d(){c.NodeElement.call(this);this.type="lion.PolygonElement";var a=this.__data__;a.width=0;a.height=0;a.points=[];a.pathPoints=[]}d.prototype=new c.NodeElement(!0);Object.defineProperties(d.prototype,{pathPoints:{get:function(){return this.getValue("pathPoints")},enumerable:!1},points:{get:function(){return this.getValue("points")},enumerable:!1},path:{get:function(){return this.getValue("path")},set:function(a){this.setValue("path",a);this.invalidLayout("bounds")},
enumerable:!0},rotate:{get:function(){return this.getValue("rotate")},set:function(a){this.setValue("rotate",a);this.invalidLayout("bounds")},enumerable:!0}});d.prototype.updateBounds=function(a){this.buildPath(this.path);a=this.parent?this.parent.drawBounds.x:0;for(var b=this.parent?this.parent.drawBounds.y:0,c=0,d=0,e=0;e<this.pathPoints.length;e++)for(var q=0;q<this.pathPoints.length;q++)if(e!=q){var m=this.pathPoints[q].x-this.pathPoints[e].x,h=this.pathPoints[q].y-this.pathPoints[e].y;m>c&&(c=
m);h>d&&(d=h)}this.drawBounds.x=this.x*this.scale+a;this.drawBounds.y=this.y*this.scale+b;this.drawBounds.width=0<this.width?this.width*this.scale:c*this.scale;this.drawBounds.height=0<this.height?this.height*this.scale:d*this.scale;this.drawBounds.calc();this.points.splice(0);for(e=0;e<this.pathPoints.length;e++)this.points[e]={},this.points[e].x=0<this.width?this.drawBounds.x+this.width/c*this.pathPoints[e].x*this.scale:this.drawBounds.x+this.pathPoints[e].x*this.scale,this.points[e].y=0<this.height?
this.drawBounds.y+this.height/d*this.pathPoints[e].y*this.scale:this.drawBounds.y+this.pathPoints[e].y*this.scale;this.fireLayout()};d.prototype.buildPath=function(a){var b=a.split(" ");this.pathPoints.splice(0);for(a=0;a<b.length;a++)if(b[a]){var d=b[a].split(","),k=parseInt(d[0]),e=parseInt(d[1]);0<this.rotate?(d=Math.sqrt(k*k+e*e),k=c.Util.toAngle(Math.atan(e/k)),k=c.Util.toRadian(this.rotate+k),this.pathPoints.push({x:Math.cos(k)*d,y:Math.sin(k)*d})):this.pathPoints.push({x:k,y:e})}if(0<this.rotate){b=
this.pathPoints[0].x;d=this.pathPoints[0].y;for(a=1;a<this.pathPoints.length;a++)this.pathPoints[a].x<b&&(b=this.pathPoints[a].x),this.pathPoints[a].y<d&&(d=this.pathPoints[a].y);for(a=0;a<this.pathPoints.length;a++)this.pathPoints[a].x+=0-b,this.pathPoints[a].y+=0-d}};d.prototype.renderHighLight=function(a){c.NodeElement.prototype.renderHighLight.call(this,a);a.strokeStyle="#333333";a.lineWidth=.5;a.strokeRect(this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height)};d.prototype.render=
function(a){a.save();a.moveTo(this.points[0].x,this.points[0].y);for(var b=1;b<this.points.length;b++)a.lineTo(this.points[b].x,this.points[b].y);a.closePath();this.backgroundColor&&a.fill();this.backgroundImage&&a.drawImage(this.backgroundImage,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height);0<this.borderSize&&(a.strokeStyle=this.borderColor,a.lineWidth=this.borderSize,a.stroke());c.Util.andEnum(this.status,c.Status.Selected)&&(a.fillStyle="rgba(255,255,255,0.7)",
a.fill());a.restore()};d.prototype.preRender=function(a){};d.prototype.setEditMode=function(a){this.canEdit&&this.canEvent&&(this.setValue("editMode",a),this.editMode>c.EditMode.Select&&this.invalidLayout())};c.PolygonElement=d}(l);!function(c){function d(){c.NodeElement.call(this);this.type="lion.BirdsEye";var a=this;this.height=this.width=100;this.position=c.Position.BottomRight;var b=new A;Object.defineProperties(this,{rect:{get:function(){return b},enumerable:!1}});var d=[];Object.defineProperties(this,
{rectChildren:{get:function(){return d},enumerable:!1}});this.onHit(function(b){var c=a.width/a.scene.width,d=a.height/a.scene.height;a.rect.x=a.drawBounds.x+b.x;a.rect.y=a.drawBounds.y+b.y;a.rect.width=a.scene.stage.width*c;a.rect.height=a.scene.stage.height*d;b=new C(b.x,b.y);b.x+a.rect.width>a.width&&(b.x=a.width-a.rect.width);b.y+a.rect.height>a.height&&(b.y=a.height-a.rect.height);a.rect.x=a.drawBounds.x+b.x;a.rect.y=a.drawBounds.y+b.y;a.scene.x=-(b.x/c);a.scene.y=-(b.y/d);a.scene.layers.action.refresh();
a.invalidLayout()})}d.prototype=new c.NodeElement;d.prototype.updateBounds=function(a){this.position==c.Position.TopLeft?(this.drawBounds.x=0,this.drawBounds.y=0):this.position==c.Position.TopRight?(this.drawBounds.x=this.stage.width-this.width,this.drawBounds.y=0):this.position==c.Position.BottomLeft?(this.drawBounds.x=0,this.drawBounds.y=this.stage.height-this.height):this.position==c.Position.BottomRight&&(this.drawBounds.x=this.stage.width-this.width,this.drawBounds.y=this.stage.height-this.height);
this.drawBounds.width=this.width;this.drawBounds.height=this.height;this.rectChildren.splice(0);a=this.width/this.scene.width;for(var b=this.height/this.scene.height,d=this.scene.layers.action.elements,k=0;k<d.length;k++)d[k]instanceof c.LinkElement||d[k]instanceof c.LineElement||this.rectChildren.push(new A(this.drawBounds.x+d[k].x*a,this.drawBounds.y+d[k].y*b,d[k].width*a,d[k].height*b))};d.prototype.render=function(a){a.fillStyle=this.backgroundColor;a.fillRect(this.drawBounds.x,this.drawBounds.y,
this.drawBounds.width,this.drawBounds.height);a.strokeStyle="rgb(255,255,255)";a.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height);a.fillStyle="rgb(100,100,100)";for(var b=0;b<this.rectChildren.length;b++)a.fillRect(this.rectChildren[b].x,this.rectChildren[b].y,this.rectChildren[b].width,this.rectChildren[b].height)};d.prototype.renderHighLight=function(a){};c.BirdsEye=d}(l);!function(c){function d(a){c.GeoElement.call(this);this.height=this.width=8;this.type="EndPoint";this.backgroundColor=
"rgb(0,162,200)";var b=this.__data__;b.controlMode=c.EndPointMode.TopLeft;b.controlElement=a;this.setParent(a)}d.prototype=new c.GeoElement;Object.defineProperties(d.prototype,{controlMode:{get:function(){return this.getValue("controlMode")},set:function(a){this.setValue("controlMode",a)},enumerable:!0},controlElement:{get:function(){return this.getValue("controlElement")},set:function(a){this.setValue("controlElement",a)},enumerable:!1},scenePosition:{get:function(){return this.getValue("scenePosition")},
enumerable:!1}});d.prototype.invalidLayout=function(a){c.GeoElement.prototype.invalidLayout.call(this,a);for(var b=0;b<this.lines.length;b++)this.lines[b].invalidLayout(a)};d.prototype.updateBounds=function(a){if(this.parent instanceof c.LineElement){a=this.scene.x;var b=this.scene.y}else a=this.parent?this.parent.drawBounds.x:0,b=this.parent?this.parent.drawBounds.y:0;this.drawBounds.x=this.x*this.scale+a;this.drawBounds.y=this.y*this.scale+b;this.drawBounds.width=this.width;this.drawBounds.height=
this.height;this.drawBounds.calc()};d.prototype.move=function(a,b){if(this.controlMode==c.EndPointMode.TopLeft)this.controlElement.editMode==c.EditMode.Free||this.controlElement.editMode==c.EditMode.NodeControl?(this.x=a,this.y=b):this.controlElement.editMode==c.EditMode.Scale&&(a=a>b?a:b,this.controlElement.x+=a,this.controlElement.y+=a,this.controlElement.width-=a,this.controlElement.height-=a);else if(this.controlMode==c.EndPointMode.TopRight)this.controlElement.editMode==c.EditMode.Free||this.controlElement.editMode==
c.EditMode.NodeControl?(this.x=a,this.y=b):this.controlElement.editMode==c.EditMode.Scale&&(this.controlElement.y+=b,this.controlElement.width-=b,this.controlElement.height-=b);else if(this.controlMode==c.EndPointMode.BottomLeft)this.controlElement.editMode==c.EditMode.Free||this.controlElement.editMode==c.EditMode.NodeControl?(this.x=a,this.y=b):this.controlElement.editMode==c.EditMode.Scale&&(this.controlElement.x+=a,this.controlElement.width-=a,this.controlElement.height-=a);else if(this.controlMode==
c.EndPointMode.BottomRight)this.controlElement.editMode==c.EditMode.Free||this.controlElement.editMode==c.EditMode.NodeControl?(this.x=a,this.y=b):this.controlElement.editMode==c.EditMode.Scale&&(this.controlElement.width+=b,this.controlElement.height+=b);else if(this.controlMode==c.EndPointMode.MiddleTop)this.controlElement.y+=b,this.controlElement.height-=b;else if(this.controlMode==c.EndPointMode.MiddleBottom)this.controlElement.height+=b;else if(this.controlMode==c.EndPointMode.MiddleLeft)this.controlElement.x+=
a,this.controlElement.width-=a;else if(this.controlMode==c.EndPointMode.MiddleRight)this.controlElement.width+=a;else if(this.controlMode==c.EndPointMode.Landscape)this.x=a;else if(this.controlMode==c.EndPointMode.Vertical)this.y=b;else if(this.controlMode==c.EndPointMode.Start||this.controlMode==c.EndPointMode.End)if(this.controlElement.editMode==c.EditMode.Free||this.controlElement.editMode==c.EditMode.NodeControl)this.x=a,this.y=b,this.controlElement.invalidLayout();for(a=0;a<this.controlElement.nodes.length;a++)this.controlElement instanceof
c.LineElement||this.controlElement.resetNodeLocation(this.controlElement.nodes[a])};d.prototype.renderHighLight=function(a){a.fillStyle=this.highlightColor;a.beginPath();a.arc(this.drawBounds.center.x,this.drawBounds.center.y,this.width/2,0,2*Math.PI);a.closePath();a.fill()};d.prototype.render=function(a){a.fillStyle=this.backgroundColor;a.beginPath();a.arc(this.drawBounds.center.x,this.drawBounds.center.y,this.width/2,0,2*Math.PI);a.fill();0<this.borderSize&&(a.strokeStyle=this.borderColor,a.lineWidth=
this.borderSize,a.stroke())};d.prototype.dispose=function(){this.controlElement=null};c.EndPoint=d}(l);!function(c){function d(a){c.NodeElement.call(this,a);this.type="lion.RectElement";a=this.__data__;a.width=50;a.height=50;a.radius=0}d.prototype=new c.NodeElement;Object.defineProperties(d.prototype,{radius:{get:function(){return this.getValue("radius")},set:function(a){this.setValue("radius",a);this.invalidLayout()},enumerable:!0}});d.prototype.updateBounds=function(a){c.NodeElement.prototype.updateBounds.call(this,
a)};d.prototype.preRender=function(a){};d.prototype.renderHighLight=function(a){this.highlightColor&&(0<this.radius?(y(a,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height,this.radius),a.fillStyle=this.highlightColor,a.fill()):(a.fillStyle=this.highlightColor,a.fillRect(this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height)))};d.prototype.renderBackground=function(a){a.shadowBlur=8;a.shadowColor=this.shadow;this.backgroundColor&&(0<this.radius?
(y(a,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height,this.radius),a.fillStyle=M(a,this.backgroundColor),a.fill()):(a.fillStyle=M(a,this.backgroundColor),a.fillRect(this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height)));this.backgroundImage&&(a.save(),0<this.radius&&a.clip(),a.drawImage(this.backgroundImage,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height),a.restore())};d.prototype.render=function(a){0<this.radius?
(y(a,this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height,this.radius),0<this.borderSize&&(a.strokeStyle=this.borderColor,a.lineWidth=this.borderSize,a.stroke())):0<this.borderSize&&!c.Util.isNullOrWhitespace(this.borderColor)&&(a.strokeStyle=this.borderColor,a.lineWidth=this.borderSize,a.strokeRect(this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height))};c.RectElement=d}(l);!function(c){function d(a){c.RectElement.call(this,a);this.type="lion.MixElement";
a=this.__data__;a.elements=[];a.events.click=[];a.width=400;a.height=400;a.eventRoute=!0;this.__hoverElement__}d.prototype=new c.RectElement;Object.defineProperties(d.prototype,{elements:{get:function(){return this.getValue("elements")},enumerable:!0},eventRoute:{get:function(){return this.getValue("eventRoute")},set:function(a){this.setValue("eventRoute",a)},enumerable:!0}});d.prototype.onClick=function(a){this.events.click.push(a)};d.prototype.setScale=function(a){for(var b=0;b<this.elements.length;b++)this.elements[b].setScale(a);
c.RectElement.prototype.setScale.call(this,a)};d.prototype.fireClick=function(a){var b=!0;if(this.eventRoute)for(var d=0;d<this.elements.length;d++){var k=this.layer.getMousePoint();this.elements[d].testPoint(k.x,k.y)&&(k=this.elements[d].fireClick(a),void 0!=k&&0==k&&(b=!1))}b&&c.RectElement.prototype.fireClick.call(this,a)};d.prototype.add=function(a){this.elements.push(a);a.setParent(this);-1==a.id&&a.setValue("id",F())};d.prototype.preRender=function(a){var b=!1;if(this.eventRoute)for(var d=0;d<
this.elements.length;d++){var k=this.layer.getMousePoint();if(null!=k)if(this.elements[d].testPoint(k.x,k.y)){if(b=!0,!this.elements[d].equals(this.__hoverElement__)){this.__hoverElement__=this.elements[d];this.__hoverElement__.fireHover();break}}else if(this.elements[d].equals(this.__hoverElement__)){this.__hoverElement__.fireLeave();break}}b||(this.__hoverElement__=null);c.RectElement.prototype.preRender.call(this,a);for(d=0;d<this.elements.length;d++)this.elements[d].preRender(a)};d.prototype.updateBounds=
function(a){c.RectElement.prototype.updateBounds.call(this,a);for(var b=0;b<this.elements.length;b++)this.elements[b].updateBounds(a)};d.prototype.renderText=function(a){for(var b=0;b<this.elements.length;b++)this.elements[b].renderText(a,this.elements[b].drawText,this.elements[b].textRect,this.elements[b].forceColor);c.RectElement.prototype.renderText.call(this,a)};d.prototype.measureText=function(a){for(var b=0;b<this.elements.length;b++)this.elements[b].measureText(a);c.RectElement.prototype.measureText.call(this,
a)};d.prototype.renderHighLight=function(a){for(var b=0;b<this.elements.length;b++){var c=this.layer.getMousePoint();this.elements[b].testPoint(c.x,c.y)&&this.elements[b].renderHighLight(a)}};d.prototype.invalidLayout=function(a){c.RectElement.prototype.invalidLayout.call(this,a);for(var b=0;b<this.elements.length;b++)this.elements[b].invalidLayout(a)};d.prototype.render=function(a){c.RectElement.prototype.render.call(this,a);for(var b=0;b<this.elements.length;b++)this.elements[b].render(a)};d.prototype.renderBackground=
function(a){c.RectElement.prototype.renderBackground.call(this,a);for(var b=0;b<this.elements.length;b++)this.elements[b].renderBackground(a)};d.prototype.dispose=function(){if(!this.isdisposed){for(var a=0;a<this.elements.length;a++)this.elements[a].dispose();this.elements.splice(0);c.RectElement.prototype.dispose.call(this);this.isdisposed=!0}};c.MixElement=d}(l);!function(c){function d(a){c.RectElement.call(this,a);this.type="lion.TextElement";a=this.__data__;a.backgroundColor=null;a.width=200;
a.height=50;a.align=c.Align.Center;a.autoSize=!0}d.prototype=new c.RectElement;Object.defineProperties(d.prototype,{autoSize:{get:function(){return this.getValue("autoSize")},set:function(a){this.setValue("autoSize",a);this.invalidLayout()},enumerable:!0}});d.prototype.updateBounds=function(a){if(this.parent instanceof c.Layer)var b=this.parent?this.parent.x:0,d=this.parent?this.parent.y:0;else b=this.parent?this.parent.drawBounds.x:0,d=this.parent?this.parent.drawBounds.y:0;if(this.autoSize){this.drawBounds.x=
this.x*this.scale+b;this.drawBounds.y=this.y*this.scale+d;this.drawBounds.width=0;this.drawBounds.height=0;if(a=this.measureText(a))this.drawBounds.width=a.width+6,this.drawBounds.height=a.height+6;this.fireLayout()}else return c.RectElement.prototype.updateBounds.call(this,a)};d.prototype.renderHighLight=function(a){};c.TextElement=d}(l);!function(c){function d(){c.BaseTextElement.call(this);this.type="lion.Tooltip";var a=this.__data__;a.position=c.Align.TopRight;a.autoSize=!0;this.align=c.Align.TopLeft;
this.width=50;this.height=30;this.borderSize=1;this.borderColor="#333333";this.backgroundColor="#eeeeee";this.canDrag=!1;this.allowMultiline=!0;var b=this;this.preRender=function(a){};this.renderHighLight=function(a){};this.render=function(a){a.shadowBlur=0;a.shadowColor="";if(b.autoSize){var c=this.getTextRect();c&&(a.fillStyle=b.backgroundColor,y(a,c.x-5,c.y-3,c.width+10,c.height+10,5),a.fill(),0<b.borderSize&&(a.strokeStyle=b.borderColor,a.lineWidth=b.borderSize,a.stroke()))}else a.fillStyle=b.backgroundColor,
y(a,b.drawBounds.x,b.drawBounds.y,b.drawBounds.width,b.drawBounds.height,5),a.fill(),0<b.borderSize&&(a.strokeStyle=b.borderColor,a.lineWidth=b.borderSize,a.stroke());b.renderText(a)}}d.prototype=new c.BaseTextElement(!0);d.prototype.updateBounds=function(a){a=this.parent?this.parent.drawBounds.bounds.rightTop.y-10:0;this.drawBounds.x=this.x*this.scale+(this.parent?this.parent.drawBounds.bounds.rightTop.x-10:0);this.drawBounds.y=this.y*this.scale+a;this.drawBounds.width=this.width*this.scale;this.drawBounds.height=
this.height*this.scale};c.Tooltip=d}(l);!function(c){function d(){c.NodeElement.call(this);this.radius=20;this.type="lion.CircleElement"}d.prototype=new c.NodeElement;Object.defineProperties(d.prototype,{width:{get:function(){return this.getValue("width")},enumerable:!1},height:{get:function(){return this.getValue("height")},enumerable:!1},radius:{get:function(){return this.getValue("radius")},set:function(a){this.setValue("width",2*a);this.setValue("height",2*a);this.setValue("radius",a);this.invalidLayout("bounds")},
enumerable:!0}});d.prototype.updateBounds=function(a){var b=this.parent?this.parent.drawBounds.y:0;this.drawBounds.x=this.x*this.scale+(this.parent?this.parent.drawBounds.x:0);this.drawBounds.y=this.y*this.scale+b;this.drawBounds.width=2*this.radius*this.scale;this.drawBounds.height=2*this.radius*this.scale;this.drawBounds.calc();for(b=0;b<this.nodes.length;b++)this.nodes[b].updateBounds(a);this.fireLayout()};d.prototype.preRender=function(a){};d.prototype.renderHighLight=function(a){a.beginPath();
a.arc(this.drawBounds.center.x,this.drawBounds.center.y,this.radius*this.scale,0,2*Math.PI);a.closePath();a.fillStyle=this.highlightColor;a.fill()};d.prototype.renderBackground=function(a){a.beginPath();a.arc(this.drawBounds.center.x,this.drawBounds.center.y,this.radius*this.scale,0,2*Math.PI);a.closePath();a.shadowColor!=this.shadow&&(a.shadowBlur=8,a.shadowColor=this.shadow);a.fillStyle!=this.backgroundColor&&(a.fillStyle=this.backgroundColor);a.fill();this.backgroundImage&&(a.save(),a.clip(),a.drawImage(this.backgroundImage,
this.drawBounds.x,this.drawBounds.y,this.drawBounds.width,this.drawBounds.height),a.restore())};d.prototype.render=function(a){0<this.borderSize&&(a.beginPath(),a.arc(this.drawBounds.center.x,this.drawBounds.center.y,this.radius*this.scale,0,2*Math.PI),a.closePath(),a.strokeStyle=this.borderColor,a.lineWidth=this.borderSize,a.stroke())};c.CircleElement=d}(l);!function(c){function d(){c.NodeElement.call(this);var a=this.__data__;this.type="lion.LineElement";a.backgroundColor="#333333";a.arrowSize=
10;a.arrowDirection=c.ArrowDirection.Right;a.arrowStyle=c.ArrowStyle.Triangle;a.bindPathAnimations=[];a.startNode=new c.EndPoint(this);a.endNode=new c.EndPoint(this);a.arrows=[];a.points=[];a.textBlocks={};a.animationInvalid=!1}d.prototype=new c.NodeElement;Object.defineProperties(d.prototype,{arrowSize:{get:function(){return this.getValue("arrowSize")},set:function(a){this.setValue("arrowSize",a);this.invalidLayout()},enumerable:!0},arrowDirection:{get:function(){return this.getValue("arrowDirection")},
set:function(a){this.setValue("arrowDirection",a);this.invalidLayout()},enumerable:!0},arrowStyle:{get:function(){return this.getValue("arrowStyle")},set:function(a){this.setValue("arrowStyle",a);this.invalidLayout()},enumerable:!0},bindPathAnimations:{get:function(){return this.getValue("bindPathAnimations")},enumerable:!1},startNode:{get:function(){return this.getValue("startNode")},set:function(a){this.setValue("startNode",a);this.invalidLayout()},enumerable:!0},endNode:{get:function(){return this.getValue("endNode")},
set:function(a){this.setValue("endNode",a);this.invalidLayout()},enumerable:!0},arrows:{get:function(){return this.getValue("arrows")},set:function(a){this.setValue("arrows",a)},enumerable:!1},points:{get:function(){return this.getValue("points")},enumerable:!1},textBlocks:{get:function(){return this.getValue("textBlocks")},enumerable:!1},animationInvalid:{get:function(){return this.getValue("animationInvalid")},set:function(a){this.setValue("animationInvalid",a)},enumerable:!1}});d.prototype.ondeserialize=
function(a,b){if("startNode"==a)return this._start_=b,!0;if("endNode"==a)return this._end_=b,!0};d.prototype.enddeserialize=function(){this.setPoint(this._start_.x,this._start_.y,this._end_.x,this._end_.y)};d.prototype.setTextBlock=function(a,b,d){var f=new c.TextElement;f.text=a;f.foreColor=d;f.setParent(this);this.textBlocks[b]={textEle:f,align:b}};d.prototype.setParent=function(a){c.NodeElement.prototype.setParent.call(this,a);this.startNode&&this.startNode.setParent(this);this.endNode&&this.endNode.setParent(this)};
d.prototype.setScale=function(a){this.scale=a;this.startNode&&this.startNode.setScale(a);this.endNode&&this.endNode.setScale(a)};d.prototype.invalidLayout=function(a){"bounds"==a&&(this.animationInvalid=!0);c.NodeElement.prototype.invalidLayout.call(this,a)};d.prototype.updateBounds=function(a){this.startNode.updateBounds(a);this.endNode.updateBounds(a);this.drawBounds.x=this.startNode.drawBounds.center.x<this.endNode.drawBounds.center.x?this.startNode.drawBounds.center.x:this.endNode.drawBounds.center.x;
this.drawBounds.y=this.startNode.drawBounds.center.y<this.endNode.drawBounds.center.y?this.startNode.drawBounds.center.y:this.endNode.drawBounds.center.y;this.drawBounds.width=Math.abs(this.startNode.drawBounds.center.x-this.endNode.drawBounds.center.x)+this.borderSize;this.drawBounds.height=Math.abs(this.startNode.drawBounds.center.y-this.endNode.drawBounds.center.y)+this.borderSize;if(this.animationInvalid)for(var b=0;b<this.bindPathAnimations.length;b++)this.bindPathAnimations[b].invalid=!0;var c=
Object.getOwnPropertyNames(this.textBlocks);for(b=0;b<c.length;b++)"__ob__"!=c[b]&&this.textBlocks[c[b]].textEle.updateBounds(a);this.fireLayout()};d.prototype.testPoint=function(a,b){var c=this.startNode.drawBounds.center,d=this.endNode.drawBounds.center,e=(d.x-c.x)*(a-c.x)+(d.y-c.y)*(b-c.y);if(0>=e)return!1;var q=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y);if(e>=q)return!1;q=e/q;e=c.x+(d.x-c.x)*q;c=c.y+(d.y-c.y)*q;return 5>=Math.sqrt((a-e)*(a-e)+(c-b)*(c-b))};d.prototype.preRender=function(a){this.points.splice(0);
this.startNode&&this.endNode&&(this.points.push({x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y}),this.points.push({x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y}),this._arrows=[],this.preArrow(a,this.points[0],this.points[1]))};d.prototype.render=function(a){if(0<this.points.length){a.fillStyle=this.backgroundColor;a.strokeStyle=this.backgroundColor;a.lineWidth=this.borderSize*this.scale;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);
for(var b=1;b<this.points.length;b++)a.lineTo(this.points[b].x,this.points[b].y);a.stroke();for(b=0;b<this._arrows.length;b++)this.renderArrow(a,this.arrowStyle,this.backgroundColor,this._arrows[b].from,this._arrows[b].to);var c=Object.getOwnPropertyNames(this.textBlocks);for(b=0;b<c.length;b++)"__ob__"!=c[b]&&this.textBlocks[c[b]].textEle.renderText(a)}if(this._poly){a.beginPath();a.moveTo(this._poly[0].x,this._poly[0].y);for(b=1;b<this._poly.length;b++)a.lineTo(this._poly[b].x,this._poly[b].y);
a.lineTo(this._poly[0].x,this._poly[0].y);a.stroke()}};d.prototype.renderHighLight=function(a){if(0<this.points.length){a.strokeStyle=this.highlightColor;a.fillStyle=this.highlightColor;a.lineWidth=this.borderSize;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var b=1;b<this.points.length;b++)a.lineTo(this.points[b].x,this.points[b].y);a.stroke();for(b=0;b<this._arrows.length;b++)this.renderArrow(a,this.arrowStyle,this.highlightColor,this._arrows[b].from,this._arrows[b].to)}};d.prototype.renderBackground=
function(a){};d.prototype.setPoint=function(a,b,d,k){this.startNode.controlMode=c.EndPointMode.Start;this.startNode.x=a;this.startNode.y=b;this.startNode.width=10;this.startNode.height=10;this.endNode.controlMode=c.EndPointMode.End;this.endNode.x=d;this.endNode.y=k;this.endNode.width=10;this.endNode.height=10};d.prototype.showNodes=function(a){this.initNodes();this.displayNodes=[];if(a)for(var b=0;b<a.length;b++)a[b]==c.EndPointMode.Start?this.displayNodes.push(this.startNode):a[b]==c.EndPointMode.End&&
this.displayNodes.push(this.endNode);else this.displayNodes.push(this.startNode),this.displayNodes.push(this.endNode)};d.prototype.lineTo=function(a,b){this.endNode.x=a;this.endNode.y=b;this.invalidLayout("bounds")};d.prototype.offset=function(a,b,c){this.startNode.x+=a;this.startNode.y+=b;this.endNode.x+=a;this.endNode.y+=b;c&&(this.startNode.x=10*Math.ceil(this.startNode.x/10),this.startNode.y=10*Math.ceil(this.startNode.y/10),this.endNode.x=10*Math.ceil(this.endNode.x/10),this.endNode.y=10*Math.ceil(this.endNode.y/
10));this.invalidLayout("bounds")};d.prototype.moveTo=function(a,b,c){this.startNode.x+=a;this.startNode.y+=b;this.endNode.x+=a;this.endNode.y+=b;c&&(this.startNode.x=10*Math.ceil(this.startNode.x/10),this.startNode.y=10*Math.ceil(this.startNode.y/10),this.endNode.x=10*Math.ceil(this.endNode.x/10),this.endNode.y=10*Math.ceil(this.endNode.y/10));this.invalidLayout("bounds")};d.prototype.getNode=function(a){0==this.nodes.length&&this.initNodes();if(a==c.EndPointMode.Start)return this.nodes[0];if(a==
c.EndPointMode.End)return this.nodes[1]};d.prototype.initNodes=function(){this.nodes.push(this.startNode);this.nodes.push(this.endNode);this.startNode.setValue("id",F());this.endNode.setValue("id",F())};d.prototype.preArrow=function(a,b,d){0<this.arrowSize&&(this.arrowDirection==c.ArrowDirection.Left?this._arrows.push({from:{x:d.x,y:d.y},to:{x:b.x,y:b.y}}):this.arrowDirection==c.ArrowDirection.Right?this._arrows.push({from:{x:b.x,y:b.y},to:{x:d.x,y:d.y}}):this.arrowDirection==c.ArrowDirection.Both&&
(this._arrows.push({from:{x:d.x,y:d.y},to:{x:b.x,y:b.y}}),this._arrows.push({from:{x:b.x,y:b.y},to:{x:d.x,y:d.y}})))};d.prototype.onserialize=function(a,b){if("startNode"==a)return'"startNode":{"x":'+b.x+',"y":'+b.y+"}";if("endNode"==a)return'"endNode":{"x":'+b.x+',"y":'+b.y+"}"};d.prototype.renderArrow=function(a,b,d,k,e){if(b==c.ArrowStyle.Arrow){var f=this.arrowSize;b=Math.atan((e.y-k.y)/(e.x-k.x));var m=l.Util.toAngle(b),h=Math.abs(b)+l.Util.toRadian(45),g=f*Math.sin(h);h=f*Math.cos(h);var p=
Math.abs(b)-l.Util.toRadian(45),n=f*Math.sin(p);f*=Math.cos(p);a.fillStyle=d;d=L(k,e);-90==m?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y+g),a.moveTo(e.x,e.y),a.lineTo(e.x-f,e.y+n)):90==m?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.moveTo(e.x,e.y),a.lineTo(e.x-f,e.y-n)):0==m?k.x>e.x?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y-g),a.moveTo(e.x,e.y),a.lineTo(e.x+f,e.y-n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.moveTo(e.x,e.y),a.lineTo(e.x-f,e.y-n)):1==d||
2==d?0>b?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y+g),a.moveTo(e.x,e.y),a.lineTo(e.x-f,e.y+n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.moveTo(e.x,e.y),a.lineTo(e.x-f,e.y-n)):0>b?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y-g),a.moveTo(e.x,e.y),a.lineTo(e.x+f,e.y-n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y+g),a.moveTo(e.x,e.y),a.lineTo(e.x+f,e.y+n));a.stroke()}else b==c.ArrowStyle.Triangle?(f=this.arrowSize,b=Math.atan((e.y-k.y)/(e.x-k.x)),m=l.Util.toAngle(b),
h=Math.abs(b)+l.Util.toRadian(45),g=f*Math.sin(h),h=f*Math.cos(h),p=Math.abs(b)-l.Util.toRadian(45),n=f*Math.sin(p),f*=Math.cos(p),a.fillStyle=d,d=L(k,e),-90==m?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y+g),a.lineTo(e.x-f,e.y+n)):90==m?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.lineTo(e.x-f,e.y-n)):0==m?k.x>e.x?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y-g),a.lineTo(e.x+f,e.y-n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.lineTo(e.x-f,e.y-n)):1==d||2==
d?0>b?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y+g),a.lineTo(e.x-f,e.y+n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-h,e.y-g),a.lineTo(e.x-f,e.y-n)):0>b?(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y-g),a.lineTo(e.x+f,e.y-n)):(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x+h,e.y+g),a.lineTo(e.x+f,e.y+n)),a.lineTo(e.x,e.y),a.closePath(),a.fill()):b==c.ArrowStyle.Circle?(k=e.x,e=e.y,b=this.arrowSize/2,a.fillStyle=d,a.beginPath(),a.arc(k,e,b,0,2*Math.PI),a.fill()):b==c.ArrowStyle.Rect&&
(k=e.x,e=e.y,b=this.arrowSize/2,a.fillStyle=d,a.beginPath(),a.fillRect(k-b,e-b,2*b,2*b))};c.LineElement=d}(l);!function(c){function d(){c.LineElement.call(this);var a=this.__data__;a.canDrag=!1;this.type="lion.LinkElement";a.startNode=null;a.endNode=null;a.startElement=null;a.endElement=null;a.onEdge=!1}function a(a,d){if(a instanceof c.RectElement){var b=c.Util.toAngle(Math.atan(a.drawBounds.height/2/(a.drawBounds.width/2)));if(a.drawBounds.center.x<d.drawBounds.center.x&&a.drawBounds.center.y<d.drawBounds.center.y){var e=
d.drawBounds.center.x-a.drawBounds.center.x;d=d.drawBounds.center.y-a.drawBounds.center.y;d=Math.atan(d/e);e=c.Util.toAngle(d);if(e<=b){b=a.drawBounds.x+a.drawBounds.width;e=a.drawBounds.width/2*Math.tan(d);var f=a.drawBounds.y+a.drawBounds.height/2+e;return{x:b,y:f}}if(e>b)return b=a.drawBounds.height/2/Math.tan(d),b=a.drawBounds.x+a.drawBounds.width/2+b,f=a.drawBounds.y+a.drawBounds.height,{x:b,y:f};console.log(e)}else if(a.drawBounds.center.x>d.drawBounds.center.x&&a.drawBounds.center.y<d.drawBounds.center.y){e=
a.drawBounds.center.x-d.drawBounds.center.x;d=d.drawBounds.center.y-a.drawBounds.center.y;d=Math.atan(d/e);e=c.Util.toAngle(d);if(e<=b)return b=a.drawBounds.x,e=a.drawBounds.width/2*Math.tan(d),f=a.drawBounds.y+a.drawBounds.height/2+e,{x:b,y:f};if(e>b)return b=a.drawBounds.height/2/Math.tan(d),b=a.drawBounds.x+a.drawBounds.width/2-b,f=a.drawBounds.y+a.drawBounds.height,{x:b,y:f};console.log(e)}else if(a.drawBounds.center.x>d.drawBounds.center.x&&a.drawBounds.center.y>d.drawBounds.center.y){e=a.drawBounds.center.x-
d.drawBounds.center.x;d=a.drawBounds.center.y-d.drawBounds.center.y;d=Math.atan(d/e);e=c.Util.toAngle(d);if(e<=b)return b=a.drawBounds.x,e=a.drawBounds.width/2*Math.tan(d),f=a.drawBounds.y+a.drawBounds.height/2-e,{x:b,y:f};if(e>b)return b=a.drawBounds.height/2/Math.tan(d),b=a.drawBounds.x+a.drawBounds.width/2-b,f=a.drawBounds.y,{x:b,y:f};console.log(e)}else if(a.drawBounds.center.x<d.drawBounds.center.x&&a.drawBounds.center.y>d.drawBounds.center.y){e=d.drawBounds.center.x-a.drawBounds.center.x;d=
a.drawBounds.center.y-d.drawBounds.center.y;d=Math.atan(d/e);e=c.Util.toAngle(d);if(e<=b)return b=a.drawBounds.x+a.drawBounds.width,e=a.drawBounds.width/2*Math.tan(d),f=a.drawBounds.y+a.drawBounds.height/2-e,{x:b,y:f};if(e>b)return b=a.drawBounds.height/2/Math.tan(d),b=a.drawBounds.x+a.drawBounds.width/2+b,f=a.drawBounds.y,{x:b,y:f};console.log(e)}else return a.drawBounds.center.y==d.drawBounds.center.y&&a.drawBounds.center.x<d.drawBounds.center.x?{x:a.drawBounds.x+a.drawBounds.width,y:a.drawBounds.center.y}:
a.drawBounds.center.y==d.drawBounds.center.y&&a.drawBounds.center.x>d.drawBounds.center.x?{x:a.drawBounds.x,y:a.drawBounds.center.y}:a.drawBounds.center.x==d.drawBounds.center.x&&a.drawBounds.center.y<d.drawBounds.center.y?{x:a.drawBounds.center.x,y:a.drawBounds.y+a.drawBounds.height}:a.drawBounds.center.x==d.drawBounds.center.x&&a.drawBounds.center.y>d.drawBounds.center.y?{x:a.drawBounds.center.x,y:a.drawBounds.y}:{x:0,y:0}}else if(a instanceof c.CircleElement)return e=d.drawBounds.center.x-a.drawBounds.center.x,
d=d.drawBounds.center.y-a.drawBounds.center.y,d=Math.atan(d/e),f=a.drawBounds.center.y+(0<e?Math.sin(d)*a.radius:-(Math.sin(d)*a.radius)),b=a.drawBounds.center.x+(0<e?Math.cos(d)*a.radius:-(Math.cos(d)*a.radius)),{x:b,y:f}}d.prototype=new c.LineElement;Object.defineProperties(d.prototype,{startElement:{get:function(){return this.getValue("startElement")},set:function(a){this.setValue("startElement",a);this.invalidLayout("bounds")},enumerable:!0},endElement:{get:function(){return this.getValue("endElement")},
set:function(a){this.setValue("endElement",a);this.invalidLayout("bounds")},enumerable:!0},onEdge:{get:function(){return this.getValue("onEdge")},set:function(a){this.setValue("onEdge",a);this.invalidLayout("bounds")},enumerable:!0}});d.prototype.ondeserialize=function(a,c){"startNode"==a&&(this._start_=c.split("_"));"endNode"==a&&(this._end_=c.split("_"))};d.prototype.moveTo=function(a,c,d){};d.prototype.enddeserialize=function(){var a=this.layer.findElementById(this._start_[0]),c=this.layer.findElementById(this._end_[0]);
this.setStartAndEnd(a,c,this._start_[1],this._end_[1]);delete this._start_;delete this._end_};d.prototype.updateBounds=function(a){this.startNode&&this.endNode&&(this.drawBounds.x=this.startNode.drawBounds.center.x<this.endNode.drawBounds.center.x?this.startNode.drawBounds.center.x:this.endNode.drawBounds.center.x,this.drawBounds.y=this.startNode.drawBounds.center.y<this.endNode.drawBounds.center.y?this.startNode.drawBounds.center.y:this.endNode.drawBounds.center.y,this.drawBounds.width=Math.abs(this.startNode.drawBounds.center.x-
this.endNode.drawBounds.center.x)+this.borderSize,this.drawBounds.height=Math.abs(this.startNode.drawBounds.center.y-this.endNode.drawBounds.center.y)+this.borderSize);if(this.animationInvalid){for(var b=0;b<this.bindPathAnimations.length;b++)this.bindPathAnimations[b].invalid=!0;this.animationInvalid=!1}var d=Object.getOwnPropertyNames(this.textBlocks);for(b=0;b<d.length;b++)if("__ob__"!=d[b]){var e=this.textBlocks[d[b]];e.textEle.updateBounds(a);e.align==c.Align.Start?(e.textEle.drawBounds.x=this.startNode.drawBounds.center.x<
this.endNode.drawBounds.center.x?this.startNode.drawBounds.center.x:this.startNode.drawBounds.center.x-e.textEle.drawBounds.width,e.textEle.drawBounds.y=this.startNode.drawBounds.y):e.align==c.Align.End?(e.textEle.drawBounds.x=this.startNode.drawBounds.center.x<this.endNode.drawBounds.center.x?this.endNode.drawBounds.center.x-e.textEle.drawBounds.width:this.endNode.drawBounds.center.x,e.textEle.drawBounds.y=this.endNode.drawBounds.y):(e.textEle.drawBounds.x=this.drawBounds.x+(this.drawBounds.width-
e.textEle.drawBounds.width)/2,e.textEle.drawBounds.y=this.drawBounds.y+(this.drawBounds.height-e.textEle.drawBounds.height)/2)}this.fireLayout()};d.prototype.preRender=function(b){this.points.splice(0);if(this.startNode&&this.endNode){if(this.startNode.controlMode==c.EndPointMode.Center){var d=a(this.startElement,this.endElement);this.points.push({x:d.x,y:d.y})}else null==this.startNode?this.points.push(this.startElement.drawBounds.center):this.points.push({x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y});
this.startElement instanceof c.RectElement&&this.endNode.controlMode==c.EndPointMode.Center?(d=a(this.endElement,this.startElement),this.points.push({x:d.x,y:d.y})):null==this.endNode?this.points.push(this.endElement.drawBounds.center):this.points.push({x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y});this._arrows=[];this.preArrow(b,this.points[0],this.points[1])}};v(d.prototype,"setStartAndEnd",function(a,c){this.startElement=a.controlElement;this.startNode=a;this.endElement=
c.controlElement;this.endNode=c;this.startNode.lines.push(this);this.endNode.lines.push(this)});v(d.prototype,"setStartAndEnd",function(a,d,k){this.onEdge=k;this.startElement=a;this.startNode=a.getNode(c.EndPointMode.Center);this.endElement=d;this.endNode=d.getNode(c.EndPointMode.Center);this.startNode.lines.push(this);this.endNode.lines.push(this)});v(d.prototype,"setStartAndEnd",function(a,c,d,e){this.startElement=a;this.startNode=a.getNode(d);this.endElement=c;this.endNode=c.getNode(e);this.startNode.lines.push(this);
this.endNode.lines.push(this)});d.prototype.setParent=function(a){c.NodeElement.prototype.setParent.call(this,a)};d.prototype.invalidLayout=function(a){"bounds"==a&&(this.animationInvalid=!0);c.BaseTextElement.prototype.invalidLayout.call(this,a)};d.prototype.onserialize=function(a,c){if("startNode"==a)return'"startNode":"'+c.controlElement.id+"_"+c.controlMode+'"';if("endNode"==a)return'"endNode":"'+c.controlElement.id+"_"+c.controlMode+'"'};c.LinkElement=d}(l);!function(c){function d(){function a(a,
c,d,e){var b={},f=1-a;b.x=f*f*c.x+2*a*f*d.x+a*a*e.x;b.y=f*f*c.y+2*a*f*d.y+a*a*e.y;return b}c.LinkElement.call(this);this.type="lion.CurveLinkElement";this.preArrow=function(b,d,k){0<this.arrowSize&&(this.arrowDirection==c.ArrowDirection.Left?(b=a(.1,this.points[0],this.points[1],this.points[2]),this._arrows.push({from:b,to:this.points[0]})):this.arrowDirection==c.ArrowDirection.Right?(b=a(.9,this.points[0],this.points[1],this.points[2]),this._arrows.push({from:b,to:this.points[2]})):this.arrowDirection==
c.ArrowDirection.Both&&(b=a(.1,this.points[0],this.points[1],this.points[2]),this._arrows.push({from:b,to:this.points[0]}),b=a(.9,this.points[0],this.points[1],this.points[2]),this._arrows.push({from:b,to:this.points[2]})))}}d.prototype=new c.LinkElement(!0);d.prototype.preRender=function(a){this.points.splice(0);this.points.push({x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y});this.points.push({x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y});this.points.splice(1,
0,{x:this.points[0].x+(this.points[1].x-this.points[0].x)/2,y:this.points[0].y+(100<2*(this.points[1].y-this.points[0].y)?100:2*(this.points[1].y-this.points[0].y))});this._arrows=[];this.preArrow(a,this.points[0],this.points[1])};d.prototype.render=function(a){a.fillStyle=this.backgroundColor;a.strokeStyle=this.backgroundColor;a.lineWidth=this.borderSize*this.scale;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);a.quadraticCurveTo(this.points[1].x,this.points[1].y,this.points[2].x,this.points[2].y);
a.stroke();for(var b=0;b<this._arrows.length;b++)this.renderArrow(a,this.arrowStyle,this.backgroundColor,this._arrows[b].from,this._arrows[b].to);var c=Object.getOwnPropertyNames(this.textBlocks);for(b=0;b<c.length;b++)"__ob__"!=c[b]&&this.textBlocks[c[b]].textEle.renderText(a)};d.prototype.renderHighLight=function(a){a.fillStyle=this.highlightColor;a.strokeStyle=this.highlightColor;a.lineWidth=this.borderSize*this.scale;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);a.quadraticCurveTo(this.points[1].x,
this.points[1].y,this.points[2].x,this.points[2].y);a.stroke();for(var b=0;b<this._arrows.length;b++)this.renderArrow(a,this.arrowStyle,this.highlightColor,this._arrows[b].from,this._arrows[b].to)};c.CurveLinkElement=d}(l);!function(c){function d(){c.LinkElement.call(this);var a=this.__data__;a.startDirection=c.Direction.Right;a.endDirection=c.Direction.Left;a.minInflexion=50;this.type="lion.RAngleLinkElement";this.__oldStartPos={x:0,y:0};this.__oldEndtPos={x:0,y:0}}function a(a,b,c){a=Math.abs(b-
a)/2;return a<c?a:c}function b(a,b,c){a=Math.abs(b-a)/2;return a>c?a:c}function f(a,b,d,f){switch(a){case c.Direction.Top:return d.y>f.y&&d.x<f.x&&b==c.Direction.Left||d.y>f.y&&d.x>f.x&&b==c.Direction.Right;case c.Direction.Bottom:return d.y<f.y&&d.x<f.x&&b==c.Direction.Left||d.y<f.y&&d.x>f.x&&b==c.Direction.Right;case c.Direction.Left:return d.x>f.x&&d.y<f.y&&b==c.Direction.Top||d.x>f.x&&d.y>f.y&&b==c.Direction.Bottom;case c.Direction.Right:return d.x<f.x&&d.y<f.y&&b==c.Direction.Top||d.x<f.x&&d.y>
f.y&&b==c.Direction.Bottom}}d.prototype=new c.LinkElement(!0);Object.defineProperties(d.prototype,{startDirection:{get:function(){return this.getValue("startDirection")},set:function(a){this.setValue("startDirection",a);this.invalidLayout("bounds")},enumerable:!0},endDirection:{get:function(){return this.getValue("endDirection")},set:function(a){this.setValue("endDirection",a);this.invalidLayout("bounds")},enumerable:!0},minInflexion:{get:function(){return this.getValue("minInflexion")},set:function(a){this.setValue("minInflexion",
a);this.invalidLayout("bounds")},enumerable:!0}});d.prototype.innerfindPoints=function(){if(this.__oldStartPos.x!=this.startNode.x||this.__oldStartPos.y!=this.startNode.y||this.__oldEndtPos.x!=this.endNode.x||this.__oldEndtPos.y!=this.endNode.y){var d=this.startNode.drawBounds.center,e=this.endNode.drawBounds.center,l=[],m=this.minInflexion,h=this.startDirection,g=d;for(l.push(d);g.x!=e.x||g.y!=e.y;){switch(h){case c.Direction.Top:g=this.endDirection==c.Direction.Top?g.x==e.x?g.y<e.y?{x:g.x,y:g.y-
a(e.y,g.y,m)}:{x:g.x,y:g.y-b(e.y,g.y,m)}:g.y<e.y?{x:g.x,y:g.y-m}:{x:g.x,y:e.y-m}:this.endDirection==c.Direction.Bottom?g.y<e.y?{x:g.x,y:g.y-m}:g.x==e.x?{x:e.x,y:e.y}:{x:g.x,y:g.y-b(e.y,g.y,m)}:f(h,this.endDirection,g,e)?{x:g.x,y:e.y}:g.y<e.y?{x:g.x,y:g.y-a(e.y,g.y,m)}:{x:g.x,y:g.y-b(e.y,g.y,m)};h=g.x<e.x?c.Direction.Right:c.Direction.Left;break;case c.Direction.Bottom:g=this.endDirection==c.Direction.Bottom?g.x==e.x?g.y<e.y?{x:g.x,y:g.y+b(e.y,g.y,m)}:{x:g.x,y:g.y+a(e.y,g.y,m)}:g.y<e.y?{x:g.x,y:e.y+
m}:{x:g.x,y:g.y+m}:this.endDirection==c.Direction.Top?g.y<e.y?g.x==e.x?{x:e.x,y:e.y}:{x:g.x,y:g.y+b(e.y,g.y,m)}:{x:g.x,y:g.y+m}:f(h,this.endDirection,g,e)?{x:g.x,y:e.y}:g.y<e.y?{x:g.x,y:g.y+b(e.y,g.y,m)}:{x:g.x,y:g.y+a(e.y,g.y,m)};h=g.x<e.x?c.Direction.Right:c.Direction.Left;break;case c.Direction.Left:g=this.endDirection==c.Direction.Left?g.y==e.y?g.x<e.x?{x:g.x-a(e.x,g.x,m),y:g.y}:{x:g.x-b(e.x,g.x,m),y:g.y}:g.x<e.x?{x:g.x-m,y:g.y}:{x:e.x-m,y:g.y}:this.endDirection==c.Direction.Right?g.x<e.x?{x:g.x-
m,y:g.y}:g.y==e.y?{x:e.x,y:e.y}:{x:g.x-b(e.x,g.x,m),y:g.y}:f(h,this.endDirection,g,e)?{x:e.x,y:g.y}:g.x<e.x?{x:g.x-a(e.x,g.x,m),y:g.y}:{x:g.x-b(e.x,g.x,m),y:g.y};h=g.y<e.y?c.Direction.Bottom:c.Direction.Top;break;case c.Direction.Right:g=this.endDirection==c.Direction.Right?g.y==e.y?g.x>e.x?{x:g.x+a(e.x,g.x,m),y:g.y}:{x:g.x+b(e.x,g.x,m),y:g.y}:g.x<e.x?{x:e.x+m,y:g.y}:{x:g.x+m,y:g.y}:this.endDirection==c.Direction.Left?g.x<e.x?g.y==e.y?{x:e.x,y:e.y}:{x:g.x+b(e.x,g.x,m),y:g.y}:{x:g.x+m,y:g.y}:f(h,this.endDirection,
g,e)?{x:e.x,y:g.y}:g.x<e.x?{x:g.x+b(e.x,g.x,m),y:g.y}:{x:g.x+a(e.x,g.x,m),y:g.y},h=g.y<e.y?c.Direction.Bottom:c.Direction.Top}l.push(g);if(10<l.length)break}this.points.splice(0);E(this.points,l);this.__oldStartPos={x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y};this.__oldEndtPos={x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y}}};v(d.prototype,"setStartAndEnd",function(a,b){throw"function setStartAndEnd(start,end) not support";});v(d.prototype,"setStartAndEnd",
function(a,b,d,f){function e(a,b,d){if(d==c.EndPointMode.MiddleLeft)return c.Direction.Left;if(d==c.EndPointMode.MiddleRight)return c.Direction.Right;if(d==c.EndPointMode.MiddleTop)return c.Direction.Top;if(d==c.EndPointMode.MiddleBottom)return c.Direction.Bottom;if(d==c.EndPointMode.End)return a.x<b.x?c.Direction.Right:a.x>b.x?c.Direction.Left:a.y<b.y?c.Direction.Bottom:c.Direction.Top;if(d==c.EndPointMode.Start)return a.x<b.x?c.Direction.Left:a.x>b.x?c.Direction.Right:a.y<b.y?c.Direction.Top:c.Direction.Bottom}
c.LinkElement.prototype.setStartAndEnd.call(this,a,b,d,f);this.startDirection=e(this.startElement,this.endElement,this.startNode.controlMode);this.endDirection=e(this.startElement,this.endElement,this.endNode.controlMode)});d.prototype.setStartAndEndDirection=function(a,b,d,f){c.LinkElement.prototype.setStartAndEnd.call(this,a,b);if(null!=d||null!=f)this.startDirection=d,this.endDirection=f};d.prototype.updateBounds=function(a){c.LinkElement.prototype.updateBounds.call(this,a);this.onEdge&&this.initDirection()};
d.prototype.initDirection=function(){var a=this.startElement.drawBounds.center.x,b=this.startElement.drawBounds.center.y,d=this.endElement.drawBounds.center.x,f=this.endElement.drawBounds.center.y;Math.abs(d-a)>Math.abs(f-b)?a<d?(this.startNode=this.startElement.getNode(c.EndPointMode.MiddleRight),this.endNode=this.endElement.getNode(c.EndPointMode.MiddleLeft),this.startDirection=c.Direction.Right,this.endDirection=c.Direction.Left):(this.startNode=this.startElement.getNode(c.EndPointMode.MiddleLeft),
this.endNode=this.endElement.getNode(c.EndPointMode.MiddleRight),this.startDirection=c.Direction.Left,this.endDirection=c.Direction.Right):b<=f?(this.startNode=this.startElement.getNode(c.EndPointMode.MiddleBottom),this.endNode=this.endElement.getNode(c.EndPointMode.MiddleTop),this.startDirection=c.Direction.Bottom,this.endDirection=c.Direction.Top):(this.startNode=this.startElement.getNode(c.EndPointMode.MiddleTop),this.endNode=this.endElement.getNode(c.EndPointMode.MiddleBottom),this.startDirection=
c.Direction.Top,this.endDirection=c.Direction.Bottom)};d.prototype.testPoint=function(a,b){for(var d=1;d<this.points.length;d++)if(c.Util.inRect(Math.min(this.points[d-1].x,this.points[d].x),Math.min(this.points[d-1].y,this.points[d].y),Math.max(2,Math.abs(this.points[d].x-this.points[d-1].x)),Math.max(2,Math.abs(this.points[d].y-this.points[d-1].y)),a,b))return!0;return!1};d.prototype.preRender=function(a){this.innerfindPoints.call(this);0!=this.points.length&&(this._arrows=[],this.arrowDirection==
c.ArrowDirection.Left?this._arrows.push({from:{x:this.points[1].x,y:this.points[1].y},to:{x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y}}):this.arrowDirection==c.ArrowDirection.Right?this._arrows.push({from:{x:this.points[this.points.length-2].x,y:this.points[this.points.length-2].y},to:{x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y}}):this.arrowDirection==c.ArrowDirection.Both&&(this._arrows.push({from:{x:this.points[this.points.length-2].x,y:this.points[this.points.length-
2].y},to:{x:this.endNode.drawBounds.center.x,y:this.endNode.drawBounds.center.y}}),this._arrows.push({from:{x:this.points[1].x,y:this.points[1].y},to:{x:this.startNode.drawBounds.center.x,y:this.startNode.drawBounds.center.y}})))};d.prototype.onserialize=function(a,b){if("startNode"==a)return'"startNode":"'+b.controlElement.id+"_"+b.controlMode+'"';if("endNode"==a)return'"endNode":"'+b.controlElement.id+"_"+b.controlMode+'"'};d.prototype.ondeserialize=function(a,b){if("startNode"==a)return this._start_=
a=b.split("_");if("endNode"==a)return this._end_=a=b.split("_")};d.prototype.enddeserialize=function(){var a=this.layer.findElementById(this._start_[0]),b=this.layer.findElementById(this._end_[0]);this.setStartAndEnd(a,b,this._start_[1],this._end_[1]);delete this._start_;delete this._end_};c.RAngleLinkElement=d}(l);!function(c){function d(){}c.Layout=d;d.AlignMode={Left:0,Right:1,Top:2,Buttom:3,Horizontal:10,Vertical:11};d.ArrangeMode={Horizontal:0,Vertical:1};d.align=function(a,b,c){c=c?c:b[0];for(var f=
0;f<b.length;f++)null==b[f].group&&(a==d.AlignMode.Left?b[f]instanceof l.Group?b[f].move(c.drawBounds.x,b[f].drawBounds.y):b[f].x=c.x:a==d.AlignMode.Right?b[f].x=c.x+c.width-b[f].width:a==d.AlignMode.Top?b[f].y=c.y:a==d.AlignMode.Buttom?b[f].y=c.y+c.height-b[f].height:a==d.AlignMode.Horizontal?b[f].y=c.y-(b[f].height-c.height)/2:a==d.AlignMode.Vertical&&(b[f].x=c.x-(b[f].width-c.width)/2))};d.arrange=function(a,b,c){for(var f=1;f<b.length;f++)a==d.ArrangeMode.Horizontal?b[f].x=b[f-1].x+b[f-1].width+
c:a==d.ArrangeMode.Vertical&&(b[f].y=b[f-1].y+b[f-1].height+c)};d.table=function(a,b,c,d){null==d&&(d=1);var e=c.width/b;d=c.height/d;for(var f=0,k=0;k<a.length;k++){var h=(k+1)%b;a[k].x=c.x+(0==h?b-1:h-1)*e;a[k].y=c.y+f*d;0==h&&f++}};d.flow=function(a,b,c){var d=null;"number"==typeof b?d=new A(0,0,b,0):b instanceof A&&(d=b);for(var e=b=0,f=0,l=[],h=0;h<a.length;h++)if(l.push(a[h]),a[h].x=d.x+b+c,a[h].y=d.y+e+c,b+=a[h].width+c,b+a[h].x+a[h].width+c>d.width){b=0;f++;for(var g=l[0].height,n=1;n<l.length;n++)l[n].height>
g&&(g=l[n].height);e+=g+c;l.splice(0)}};d.around=function(a,b,d,k){var e=e=360/a.length;k=k?k:0;var f=0;d||(d=a[0],e=360/(a.length-1),f=1);for(;f<a.length;f++){var l=c.Util.toRadian(k),h=b*Math.cos(l);l=b*Math.sin(l);d.drawBounds&&1!=d.drawBounds.empty?(a[f].x=d.drawBounds.x+h-a[f].height/2,a[f].y=d.drawBounds.y+l-a[f].height/2):(a[f].x=d.center.x+h-a[f].height/2,a[f].y=d.center.y+l-a[f].height/2);k+=e}};d.center=function(a,b){if(a instanceof Array)for(var d=p(a),k=0;k<a.length;k++)a[k]instanceof
c.LineElement?a[k].moveTo(a[k].x+(b.width-d.width)/2-d.x,a[k].y+(b.height-d.height)/2-d.y):(a[k].x=a[k].x+(b.width-d.width)/2-d.x,a[k].y=a[k].y+(b.height-d.height)/2-d.y);else a.x=b.x+(b.width-a.width)/2,a.y=b.y+(b.height-a.height)/2}}(l);return l.Timer.init()}(window);
